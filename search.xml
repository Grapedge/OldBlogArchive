<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Android 键盘遮挡控件的解决方案]]></title>
      <url>http://blog.grapedge.top/2018/10/android-imb/</url>
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在上一篇博客实现了一个简单的登录的界面，但由于我们的输入框是放在中间的位置，而登录按钮处于输入框的下方，所以当我们进行输入时，弹出的软键盘会遮挡住登录的按钮。我们要实现的就是弹出输入法后，界面向上滚动，使得按钮可以被显示出来。<br><img src="https://s1.ax1x.com/2018/10/21/iBdc0e.png" alt="输入法遮挡了登录按钮"></p>
<a id="more"></a>
<h2 id="实现点击空白处隐藏软键盘"><a href="#实现点击空白处隐藏软键盘" class="headerlink" title="实现点击空白处隐藏软键盘"></a>实现点击空白处隐藏软键盘</h2><p>因为现在弹出软键盘后我们点击空白处并不会自动收起软键盘，而长期的使用习惯使得我想去实现这个功能。<strong>如果你不感兴趣，可以跳过这个部分</strong>。</p>
<p>实现的思路是，如果当前是处于输入状态，并且触发了点击事件，我们就判断点击的坐标点是否在输入框内，如果不是，那么隐藏软键盘。</p>
<h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现点击空白处隐藏软键盘</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">touchBlank</span><span class="params">(View v, MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (v != <span class="keyword">null</span> &amp;&amp; v <span class="keyword">instanceof</span> EditText) &#123;</span><br><span class="line">        Rect rect = <span class="keyword">new</span> Rect();</span><br><span class="line">        v.getHitRect(rect);</span><br><span class="line">        <span class="comment">// 判断点击点是否在编辑框区域外</span></span><br><span class="line">        <span class="keyword">if</span> (!rect.contains((<span class="keyword">int</span>)ev.getX(), (<span class="keyword">int</span>)ev.getY())) &#123;</span><br><span class="line">            <span class="comment">// 隐藏软键盘</span></span><br><span class="line">            ((InputMethodManager)getSystemService(INPUT_METHOD_SERVICE)).hideSoftInputFromWindow(v.getWindowToken(), InputMethodManager.HIDE_NOT_ALWAYS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        touchBlank (getCurrentFocus(), ev);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了，下面我们进入正题。</p>
<h2 id="通过-ScrollView-实现"><a href="#通过-ScrollView-实现" class="headerlink" title="通过 ScrollView 实现"></a>通过 ScrollView 实现</h2><p><code>ScrollView</code> 像是一个容器，可以让其中的内容垂直滚动显示，我们把需要不被遮挡的控件放入其中，注意，<code>ScrollView</code> 只能存放一个子 <code>View</code> 或 <code>ViewGroup</code> 。在这里，我们这么编写布局文件 <code>activity_login.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"#e9f2fa"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ScrollView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/scroll_view"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_random_image"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"232dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:src</span>=<span class="string">"@mipmap/login_background0"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_account_edit"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:hint</span>=<span class="string">"账号/手机号/邮箱"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:paddingLeft</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"60dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginBottom</span>=<span class="string">"5dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:inputType</span>=<span class="string">"number"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:singleLine</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:maxLength</span>=<span class="string">"10"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"#fff"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_password_edit"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:hint</span>=<span class="string">"密码"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:paddingLeft</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"60dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginBottom</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:inputType</span>=<span class="string">"textPassword"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:singleLine</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:maxLength</span>=<span class="string">"15"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"#fff"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_login_button"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"登录"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginLeft</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginRight</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textSize</span>=<span class="string">"18dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:textColor</span>=<span class="string">"#fff"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:background</span>=<span class="string">"#4ea6fd"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"left"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"无法登录？"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"right"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingRight</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"注册账号"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们<strong>先注释掉点击空白处隐藏软键盘</strong>的代码然后运行，发现在点击输入框后上方内容是可以滚动的，我们实现一个滚动至按钮的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">scrollTo</span><span class="params">(<span class="keyword">final</span> ScrollView scrollView, <span class="keyword">final</span> <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">    scrollView.postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            scrollView.scrollTo(<span class="number">0</span>, to);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">233</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">scrollToButton</span><span class="params">(<span class="keyword">final</span> ScrollView scrollView, <span class="keyword">final</span> Button button)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 让布局自动调整大小</span></span><br><span class="line">    getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE);</span><br><span class="line">    scrollView.postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span>[] location = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">            button.getLocationInWindow(location);</span><br><span class="line">            scrollTo(scrollView, location[<span class="number">1</span>] + button.getHeight());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">233</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意我们进行了延时 <code>233ms</code> ，因为键盘弹出需要一定的时间（通常是 $100-300$ 之间）。</p>
<p>然后我们监听每一个编辑框的 <code>onFocusChange</code> ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFocusChange</span><span class="params">(View v, <span class="keyword">boolean</span> hasFocus)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (hasFocus)</span><br><span class="line">        scrollToButton(loginScrollView, loginButton);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行后我们发现虽然实现了效果，但有明显的类似于卡顿的现象。</p>
<h2 id="通过监听布局变化实现"><a href="#通过监听布局变化实现" class="headerlink" title="通过监听布局变化实现"></a>通过监听布局变化实现</h2><p>延时的方法显然有明显的缺陷，而在布局发生变化时才是最好的改变布局的时间。我们移除 <code>ScrollView</code> 组件，修改布局文件为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"#e9f2fa"</span> &gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/login_view"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_random_image"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"232dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">"@mipmap/login_background0"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_account_edit"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:hint</span>=<span class="string">"账号/手机号/邮箱"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"60dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginBottom</span>=<span class="string">"5dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:inputType</span>=<span class="string">"number"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:singleLine</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:maxLength</span>=<span class="string">"10"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"#fff"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_password_edit"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:hint</span>=<span class="string">"密码"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"60dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginBottom</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:inputType</span>=<span class="string">"textPassword"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:singleLine</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:maxLength</span>=<span class="string">"15"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"#fff"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_login_button"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"登录"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginRight</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"18dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">"#fff"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"#4ea6fd"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"left"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"无法登录？"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"right"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingRight</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"注册账号"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>我们把需要动态移动的布局添加上了一个 <code>login_view</code> 的 id。<br>然后，我们在 <code>LoginActivity</code> 中进行监听：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> scrollTo = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scrollToButton</span><span class="params">(<span class="keyword">final</span> Button button)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> LinearLayout loginView = findViewById(R.id.login_view);</span><br><span class="line">    loginView.getViewTreeObserver().addOnGlobalLayoutListener(<span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Rect rect = <span class="keyword">new</span> Rect();</span><br><span class="line">            <span class="comment">// 获得可见区域的高度</span></span><br><span class="line">            loginView.getWindowVisibleDisplayFrame(rect);</span><br><span class="line">            <span class="comment">// 父布局的高度减去可见区域的底部高度就是不可见区域的高度</span></span><br><span class="line">            <span class="keyword">int</span> invisibleHeight = loginView.getRootView().getHeight() - rect.bottom;</span><br><span class="line">            <span class="comment">// 如果不可见高度大于150说明键盘已经打开</span></span><br><span class="line">            <span class="keyword">if</span> (invisibleHeight &gt; <span class="number">150</span>) &#123;</span><br><span class="line">                <span class="comment">// 下面的部分和 ScrollView 版是相似的原理</span></span><br><span class="line">                <span class="keyword">int</span>[] location = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">                button.getLocationInWindow(location);</span><br><span class="line">                <span class="comment">// 计算应该移动到的位置</span></span><br><span class="line">                scrollTo += location[<span class="number">1</span>] + button.getHeight() - rect.bottom;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> scrollTo = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            loginView.scrollTo(<span class="number">0</span>, scrollTo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最终实现效果如下：<br><img src="https://s1.ax1x.com/2018/10/21/iByLrt.png" alt="实现效果"><br>这样键盘就不会遮挡我们的登录按钮了。</p>
<p>实际上，我们可能还想让键盘不遮挡一些文本类的，我们只需要将 <code>private void scrollToButton(final Button button)</code> 中的 <code>Button</code> 替换为 <code>View</code> 就可以实现移动至各种控件了。</p>
<h2 id="项目代码下载"><a href="#项目代码下载" class="headerlink" title="项目代码下载"></a>项目代码下载</h2><p>点击 <a href="https://github.com/Grapedge/AndroidActivity-QQ-Login/tree/master" target="_blank" rel="noopener">此链接</a> 进入 github 中对应的仓库。</p>
<p>或者通过 <a href="https://pan.baidu.com/s/1CjdROeLl4R98N0Bp8Yg6HA" target="_blank" rel="noopener">百度网盘</a> （提取码：p2bl）进行下载。</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
            <category> Activity </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Activity </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 模仿 QQ 登录界面]]></title>
      <url>http://blog.grapedge.top/2018/10/android-qqchat-login/</url>
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>学线移动端布置的任务为模仿制作一个 <code>QQ</code> 登录界面，所以这篇博客的定位为 <code>Activity</code> 实战。分析打开 <code>QQ</code> 的过程，大致分为 <code>Splash</code> 页面和输入账号密码以及验证登录。</p>
<a id="more"></a>
<h2 id="Splash-screen"><a href="#Splash-screen" class="headerlink" title="Splash screen"></a>Splash screen</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p><code>Splash</code> 是程序的启动页，如果我们的 <code>APP</code> 加载十分耗时，用户打开我们的 <code>APP</code> 后看到的便是一个空的页面，为了避免这种现象的发生，我们可以绘制一个 <code>Splash screen</code> 让用户看到的不是空白的界面。当然，你也可以将其用来展示一些广告、营销等。而 <code>QQ</code> 的这个界面看起来是这个样子的（当然这个画面不是必要的）：<br><img src="https://s1.ax1x.com/2018/10/19/i0Auz8.png" alt="QQ Splash"></p>
<h3 id="界面编写"><a href="#界面编写" class="headerlink" title="界面编写"></a>界面编写</h3><p>我们首先需要准备好一张需要显示的图片，例如我选择了这张图片（<strong>我没压缩这张图！！！</strong>流量党现在跑也来不及了）：<br><img src="https://s1.ax1x.com/2018/10/19/i0AoTA.png" alt="splash"></p>
<p>然后，我们将这张图片放到 <code>mipmap</code> 这个目录中（当然我们也可以放到 <code>drawable</code> 之中，但效率不如使用 <code>mipmap</code> ，而且这种存放图片的方式已经不被推荐）。<br><img src="https://s1.ax1x.com/2018/10/19/i0ESTs.png" alt="result"></p>
<p>我们不需要用到系统提供的 <code>Action Bar</code>，所以我们修改 <code>res/values/styles.xml</code> 中的 <code>style</code> 标签：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="undefined"></span></span><br></pre></td></tr></table></figure>
<p>创建一个名为 <code>SplashActivity</code> 的 <code>Activity</code>，修改其布局文件 <code>activity_splash.xml</code> 为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@mipmap/load"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>其中的 <code>android:scaleType</code> 表示图片的缩放类型，因为图片分辨率是固定的，而我们又想让他适应屏幕的大小，所以我们需要进行一定取舍的缩放，其常用的值如下：</p>
<table>
<thead>
<tr>
<th>可选值</th>
<th>缩放方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>center</td>
<td>按图片原来的大小进行居中显示，超出屏幕的部分会被截掉</td>
</tr>
<tr>
<td>centerCrop</td>
<td>按图片的比例放大后居中显示</td>
</tr>
<tr>
<td>centerInside</td>
<td>按图片的比例缩小后居中显示</td>
</tr>
<tr>
<td>fitCenter</td>
<td>图片按比例缩放后居中显示，使得其宽度等于 <code>View</code> 的宽度</td>
</tr>
</tbody>
</table>
<p>现在我们运行程序，就能看见我们的 <code>Splash</code> 画面了。接下来我们实现等待两秒后后打开登录界面。</p>
<h3 id="打开登录界面"><a href="#打开登录界面" class="headerlink" title="打开登录界面"></a>打开登录界面</h3><p>我们先创建一个登录界面 <code>LoginActivity</code> ，我们使用最简单的线性布局。然后打开 <code>SplashActivity.java</code> ，编写代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SplashActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler handler = <span class="keyword">new</span> Handler();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_splash);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 延时两秒打开登录界面</span></span><br><span class="line">        handler.postDelayed(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(SplashActivity.<span class="keyword">this</span>, LoginActivity.class);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">                finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>延时两秒有多种实现方式（参考 <code>Java</code> 中的线程），而在 <code>Android</code> 中，我们可以轻松的通过其消息机制实现这个功能。</p>
<p>我们首先需要有一个 <code>Handler</code> ，而通过其 <code>postDelayed</code> 方法可以实现一个延迟效果（这里说一点，如果要直接使用 java 里的线程的话，子线程是不能更新 UI 的，具体什么意思试过就明白了），这个函数有两个参数，第一个是一个 <code>Runnable</code> 接口类型，实现其 <code>run</code> 方法并在 <code>run</code> 方法中实现你要完成的功能。第二个参数 <code>delayMillis</code> 表示延迟多少 <code>ms</code> ，例如 $2000$ 表示 $2$ 秒。</p>
<p>如果你没有学过线程或接口，可以先记住这样的一个固定写法，在你学过这些之后在回头看自然就会理解。</p>
<h2 id="编写登录界面"><a href="#编写登录界面" class="headerlink" title="编写登录界面"></a>编写登录界面</h2><p>我们的界面大致分为这几个部分：<br><img src="https://s1.ax1x.com/2018/10/19/i0VqsS.png" alt="Part"></p>
<p>将 <code>activity_login.xml</code> 修改为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"#e9f2fa"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_random_image"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"232dp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_account_edit"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:hint</span>=<span class="string">"账号/手机号/邮箱"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"60dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginBottom</span>=<span class="string">"3dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginBottom</span>=<span class="string">"5dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:inputType</span>=<span class="string">"number"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:singleLine</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:maxLength</span>=<span class="string">"10"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"#fff"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_password_edit"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:hint</span>=<span class="string">"密码"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:paddingLeft</span>=<span class="string">"15dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"60dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginBottom</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:inputType</span>=<span class="string">"textPassword"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:singleLine</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:maxLength</span>=<span class="string">"15"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"#fff"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_login_login_button"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"登陆"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginRight</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textSize</span>=<span class="string">"18dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:textColor</span>=<span class="string">"#fff"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">"#4ea6fd"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"left"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"无法登陆？"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">"right"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"注册"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>至此我们的界面就写好了。</p>
<h2 id="设置动态背景"><a href="#设置动态背景" class="headerlink" title="设置动态背景"></a>设置动态背景</h2><p>登录界面的背景如果只有一张图片未免就有些无聊了，所以我们设置多张图片每隔 $10s$ 随机切换。要实现这个功能，首先要准备几组大小相同的图片，我分别命名为 <code>login_background + index</code> ，使用数字命名的好处是我可以通过 <code>for</code> 来获取图片资源。</p>
<p>修改 <code>LoginActivity.java</code> ，实现对应函数：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] backgroundIds = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化图片资源</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupBackground</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; backgroundIds.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 获取图片的id</span></span><br><span class="line">        <span class="keyword">int</span> resId = getResources().getIdentifier(<span class="string">"login_background"</span> + i, <span class="string">"mipmap"</span>, <span class="keyword">this</span>.getPackageName());</span><br><span class="line">        backgroundIds[i] = resId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态改变图片</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">changeImageWithTimeInterval</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ImageView imageView = findViewById(R.id.activity_login_random_image);</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> delayMillis = <span class="number">10000</span>;</span><br><span class="line">    <span class="keyword">final</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> index = random.nextInt() % backgroundIds.length;</span><br><span class="line">            index = index &lt; <span class="number">0</span> ? index + backgroundIds.length : index;</span><br><span class="line">            imageView.setImageResource(backgroundIds[index]);</span><br><span class="line">            imageView.postDelayed(<span class="keyword">this</span>, delayMillis);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>一些难点在代码中都有描述，这里主要讲解动态更换的实现原理。</p>
<h3 id="延时更换图片"><a href="#延时更换图片" class="headerlink" title="延时更换图片"></a>延时更换图片</h3><p>一说到延时这个词，自然就能想到我们开头讲的 <code>handler.postDelayed</code>，注意到这里我们是在 <code>run</code> 里面执行的 <code>imageView.postDelayed(this, delayMillis);</code> ，第一个 <code>Runnable</code> 我们传入的是 <code>this</code> ，也就是我们写在这里的匿名接口，通过这种调用方式，更通俗的说，我们执行 <code>run</code> 到 <code>imageView.postDelayed(this, delayMillis);</code> 时，就会发送一条消息，在指定延迟时间后执行 <code>this</code> 的 <code>run</code> ，也就是重新执行我们的这个 <code>run</code> 函数，自然就实现了一个类似于计时器的效果。</p>
<p>然后，你只需要在 <code>onCreate</code> 中调用这两个函数就行了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_login);</span><br><span class="line"></span><br><span class="line">    setupBackground();</span><br><span class="line">    changeImageWithTimeInterval();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此，我们的登录界面便实现完成了。</p>
<p><img src="https://s1.ax1x.com/2018/10/20/i0mFUJ.png" alt="效果图"></p>
<h2 id="验证账号密码"><a href="#验证账号密码" class="headerlink" title="验证账号密码"></a>验证账号密码</h2><p>现实中，我们往往只是把用户输入的账号密码加密后发送至服务器端进行验证然后获取登录信息，但这里由于条件的限制，我们只做一个简单的字符串比较检测。</p>
<p>我们先确定账号和密码是什么，这里我选择账号为 <code>203202537</code> ，密码我设置为 <code>123456</code> 。</p>
<p>这个比较过程应该在登录按钮点击时发生，所以我们键入：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String ACCOUNT = <span class="string">"203202537"</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String PASSWORD = <span class="string">"123456"</span>;</span><br><span class="line"><span class="keyword">private</span> EditText accountEdit;</span><br><span class="line"><span class="keyword">private</span> EditText passwdEdit;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Button login = findViewById(R.id.activity_login_login_button);</span><br><span class="line">    accountEdit = findViewById(R.id.activity_login_account_edit);</span><br><span class="line">    passwdEdit = findViewById(R.id.activity_login_password_edit);</span><br><span class="line"></span><br><span class="line">    login.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            String account = accountEdit.getText().toString();</span><br><span class="line">            String passwd = passwdEdit.getText().toString();</span><br><span class="line">            <span class="keyword">if</span> (account.equals(ACCOUNT) &amp;&amp; passwd.equals(PASSWORD)) &#123;</span><br><span class="line">               <span class="comment">// 进入聊天界面</span></span><br><span class="line">               startActivity(<span class="keyword">new</span> Intent(LoginActivity.<span class="keyword">this</span>, MainActivity.class));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Toast.makeText(LoginActivity.<span class="keyword">this</span>, <span class="string">"账号或密码错误"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="使用隐式Intent打开登录界面"><a href="#使用隐式Intent打开登录界面" class="headerlink" title="使用隐式Intent打开登录界面"></a>使用隐式Intent打开登录界面</h2><p>显示 <code>Intent</code> 虽然直观，但我们一般只能在自己的程序中才能这么使用。我们的登录界面可能会被其他程序使用到，所以我们使用隐式 <code>Intent</code> 来实现登录界面的打开。</p>
<p>我们在 <code>AndroidManifest.xml</code> 中加入 <code>intent-filter</code> 来让我们的登录界面增加一些过滤选项：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">".LoginActivity"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"top.grapedge.qqlogin.intent.action.LOGIN"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>由于 <code>action</code> 的字符串往往会很长，所以我们在 <code>LoginActivity.java</code> 中加入一个常量，表示这个字符串：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTION = <span class="string">"top.grapedge.qqlogin.intent.action.LOGIN"</span>;</span><br></pre></td></tr></table></figure>
<p>这样我们重新修改 <code>SplashActivity.java</code> 中启动登录界面的代码为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(LoginActivity.ACTION);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure></p>
<p>这样我们就实现了隐式打开登录界面。</p>
<h2 id="完整的登录界面代码"><a href="#完整的登录界面代码" class="headerlink" title="完整的登录界面代码"></a>完整的登录界面代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.grapedge.qqlogin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTION = <span class="string">"top.grapedge.qqlogin.intent.action.LOGIN"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String ACCOUNT = <span class="string">"203202537"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String PASSWORD = <span class="string">"123456"</span>;</span><br><span class="line">    <span class="keyword">private</span> EditText accountEdit;</span><br><span class="line">    <span class="keyword">private</span> EditText passwdEdit;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_login);</span><br><span class="line"></span><br><span class="line">        setupBackground();</span><br><span class="line">        changeImageWithTimeInterval();</span><br><span class="line">        </span><br><span class="line">        setupButton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Button login = findViewById(R.id.activity_login_login_button);</span><br><span class="line">        accountEdit = findViewById(R.id.activity_login_account_edit);</span><br><span class="line">        passwdEdit = findViewById(R.id.activity_login_password_edit);</span><br><span class="line"></span><br><span class="line">        login.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                String account = accountEdit.getText().toString();</span><br><span class="line">                String passwd = passwdEdit.getText().toString();</span><br><span class="line">                <span class="keyword">if</span> (account.equals(ACCOUNT) &amp;&amp; passwd.equals(PASSWORD)) &#123;</span><br><span class="line">                    <span class="comment">// 进入聊天界面</span></span><br><span class="line">                    startActivity(<span class="keyword">new</span> Intent(LoginActivity.<span class="keyword">this</span>, MainActivity.class));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(LoginActivity.<span class="keyword">this</span>, <span class="string">"账号或密码错误"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] backgroundIds = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化图片资源</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupBackground</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; backgroundIds.length; i++) &#123;</span><br><span class="line">            <span class="comment">// 获取图片的id</span></span><br><span class="line">            <span class="keyword">int</span> resId = getResources().getIdentifier(<span class="string">"login_background"</span> + i, <span class="string">"mipmap"</span>, <span class="keyword">this</span>.getPackageName());</span><br><span class="line">            backgroundIds[i] = resId;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态改变图片</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">changeImageWithTimeInterval</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ImageView imageView = findViewById(R.id.activity_login_random_image);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> delayMillis = <span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">final</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> index = random.nextInt() % backgroundIds.length;</span><br><span class="line">                index = index &lt; <span class="number">0</span> ? index + backgroundIds.length : index;</span><br><span class="line">                imageView.setImageResource(backgroundIds[index]);</span><br><span class="line">                imageView.postDelayed(<span class="keyword">this</span>, delayMillis);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
            <category> Activity </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Activity </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 广播机制（二）]]></title>
      <url>http://blog.grapedge.top/2018/10/android-broadcast2/</url>
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>上一篇文章中使用了动态广播对网络状态变化进行了侦测，在这篇文章中我们将介绍静态广播、自定义广播以及有序广播。<br><a id="more"></a></p>
<h2 id="使用静态广播监测系统开机"><a href="#使用静态广播监测系统开机" class="headerlink" title="使用静态广播监测系统开机"></a>使用静态广播监测系统开机</h2><p>静态广播的相对优点就是可以在程序没有启动的情况下就能收到广播（当然这样做的缺点也很明显），我们下面实现一个开机后收到广播并处理的实例。<br>新建一个广播接收器 <code>BootReceiver.java</code> ，其实在上一篇文章中就发现我们在注册的广播接收器中有 <code>enabled</code> 和 <code>exported</code> 这两个属性，<code>enabled</code> 顾名思义，而<code>exported</code> 的表示我们是否导出，如果我们设置为 <code>false</code> ，这个广播接收器将不接收自身程序以外来源的广播。核心代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BootReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(context, <span class="string">"正在启动我们的程序..."</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        Intent start = <span class="keyword">new</span> Intent(context, MainActivity.class);</span><br><span class="line">        start.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">        context.startActivity(start);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建广播接收器要记得在 <code>AndroidManifest.xml</code> 中注册这个广播接收器，我们修改其中相应的代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".BootReceiver"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.BOOT_COMPLETED"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>监听开机广播实际上是需要权限的，所以我们加入<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.RECEIVE_BOOT_COMPLETED"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>来声明权限。</p>
<p>因为开机消息是由系统发出的，所以我们编写这些内容便大致实现了 <code>开机广播接收器</code> 。 </p>
<p>运行后，我们可以通过长按模拟器中的 <code>Power</code> ，选择 <code>Restart</code> 重启设备。<br><img src="https://s1.ax1x.com/2018/10/17/id5h8S.png" alt="重启设备"></p>
<p>重启设备后，发现我们的程序完成了开机自启动的功能。<br><img src="https://s1.ax1x.com/2018/10/17/id57bn.png" alt="效果"></p>
<h2 id="创建自定义广播消息"><a href="#创建自定义广播消息" class="headerlink" title="创建自定义广播消息"></a>创建自定义广播消息</h2><p>自定义其实指的是广播消息的自定义，而参考以上内容不难猜到要自定义广播消息只需要把<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.BOOT_COMPLETED"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>中的 <code>android:name</code> 换成我们自己的消息就可以了。<br>创建一个新的广播接收器，命名为 <code>MyReceiver.java</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        Toast.makeText(context, <span class="string">"这是我们的自定义广播"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们修改相应的内容为：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".MyReceiver"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"top.grapedge.broadcasttest.action.BROADCASTTEST"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在 <code>main_activity</code> 中加入一个按钮<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/send_broadcast_button"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">"发送自定义广播"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后我们设置按钮的点击事件：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    Button button = findViewById(R.id.send_broadcast_button);</span><br><span class="line">    button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent(<span class="string">"top.grapedge.broadcasttest.action.BROADCASTTEST"</span>);</span><br><span class="line">            intent.setComponent(<span class="keyword">new</span> ComponentName(MainActivity.<span class="keyword">this</span>, <span class="string">"top.grapedge.broadcasttest.MyReceiver"</span>));</span><br><span class="line">            sendBroadcast(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>没错，我们发送广播正是借用了 <code>Intent</code> ，通过其 <code>setComponent</code> 设置组件，<code>ComponentName</code> 的构造函数的两个参数分别是我们程序的包名（也可以写成字符串的形式）和广播接收器的<strong>完整类名</strong>，上面演示的是一种静态广播，这是一种不被推荐的方式，而动态广播的使用方式其实和<a href="/2018/10/android-broadcast1/">上一篇文章</a>中用法一样，只是把其中的内容改成我们自己的，然后我们只需要通过<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="string">"top.grapedge.broadcasttest.action.BROADCASTTEST"</span>);</span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure></p>
<p>即可发送动态广播，这种方式大家自行实践即可，需要强调的是我们建议在 <code>onResume</code> 中注册广播，在 <code>onPause</code> 中取消广播的注册（这是最节省资源的方式）。</p>
<h2 id="有序广播的使用"><a href="#有序广播的使用" class="headerlink" title="有序广播的使用"></a>有序广播的使用</h2><p>和无序广播相比，有序广播的优点就是他是同步发送，可以被截断的，这种广播的接收是一种类似于 <code>队列</code> 的方式，而我们发送有序广播的方式也很简单，只需要稍微修改 <code>sendBroadcast</code> 即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sendOrderedBroadcast(intent, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<p>其中第一个参数不需要解释，第二参数是一个字符串，表示拥有此权限才能接收这个广播（广播是可以跨进程的）。</p>
<p>说好是有序广播，到现在为止我们却没有看出来他有序，那么怎么实现按顺序接收呢？<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">"100"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>答案是设置广播接收器 <code>intent-filter</code> 的 <code>priority</code> ，这个值越大，他将越前收到广播，而我们收到广播后可以使用 <code>abortBroadcast()</code> 来截断广播消息，这样之后的广播接收器就不会收到这条广播了。</p>
<h2 id="本地广播"><a href="#本地广播" class="headerlink" title="本地广播"></a>本地广播</h2><p>我们会发现之前介绍的广播发送是很不安全的，可能我们的广播会跨进程发送而导致不想被其他程序知道的<strong>数据</strong>（别忘了我们通过什么发送广播）被截获，又有可能收到其他程序的恶意广播，所以 <code>Android</code> 引入了一套本地广播机制，即使用 <code>LocalBroadcastManager</code> 来进行广播的管理，使用它发送或接收的广播就只会在我们的应用程序生效。其大部分发送接收方式和全局广播是一样的。</p>
<p>声明一个 <code>LocalBroadcastManager</code>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LocalBroadcastManager localBroadcastManager;</span><br></pre></td></tr></table></figure></p>
<p>获取实例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localBroadcastManager = LocalBroadcastManager.getInstance(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p>
<p>发送广播：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">localBroadcastManager.registerReceiver(myReceiver, intentFilter);</span><br><span class="line">localBroadcastManager.sendBroadcast(intent);</span><br><span class="line">localBroadcastManager.registerReceiver(myReceiver);</span><br></pre></td></tr></table></figure>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>除了文章中介绍的一些广播外，还有一些其他类型的广播，大家可以根据需要进行学习。</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
            <category> 广播机制 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Broadcast </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 广播机制（一）]]></title>
      <url>http://blog.grapedge.top/2018/10/android-broadcast1/</url>
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Android 有一套完备的广播机制。当系统或程序发送了广播之后，对此广播感兴趣的<strong>广播接收器</strong>会收到并处理这条广播。广播有很多用处，例如监听系统的网络变化。<br><a id="more"></a></p>
<h2 id="类别"><a href="#类别" class="headerlink" title="类别"></a>类别</h2><p>Android 中的广播主要可以分为五类：</p>
<ul>
<li>Normal Broadcast</li>
<li>System Broadcast</li>
<li>Ordered Broadcast</li>
<li>Sticky Broadcast</li>
<li>Local Broadcast</li>
</ul>
<p>其中最常用的是 <code>Normal Broadcast</code> 与 <code>Ordered Broadcast</code> ，他们之间最大的区别就是 <code>Normal Broadcast</code> 发送的广播是<strong>异步无序</strong>的，而 <code>Ordered Broadcast</code> 的广播是<strong>同步有序</strong>的，也就意味着前者的广播无法被截断但效率高，后者可以被截断但效率相对会低。</p>
<h2 id="系统广播"><a href="#系统广播" class="headerlink" title="系统广播"></a>系统广播</h2><p>广播系统的消息被封装在 <code>intent</code> 中，其中的 <code>action name</code> 用于标识广播。其中<strong>部分</strong>（如果有时间我会进行补全）的系统广播的 <code>action name</code> 如下：</p>
<table>
<thead>
<tr>
<th>action name</th>
<th>在此状态发送广播</th>
</tr>
</thead>
<tbody>
<tr>
<td>ACTION_AIRPLANE_MODE_CHANGED</td>
<td>更改飞行模式状态</td>
</tr>
<tr>
<td>ACTION_APPLICATION_RESTRICTIONS_CHANGED</td>
<td>更改应用权限时</td>
</tr>
<tr>
<td>ACTION_BATTERY_CHANGED</td>
<td>电池电量改变</td>
</tr>
<tr>
<td>ACTION_BATTERY_LOW</td>
<td>电池电量过低</td>
</tr>
<tr>
<td>ACTION_BATTERY_OKAY</td>
<td>电池电量饱满（由低入高）</td>
</tr>
<tr>
<td>ACTION_BOOT_COMPLETED</td>
<td>只广播一次，系统启动后</td>
</tr>
<tr>
<td>ACTION_CAMERA_BUTTON</td>
<td>按下相机拍照按键（物理）时</td>
</tr>
<tr>
<td>ACTION_CLOSE_SYSTEM_DIALOGS</td>
<td>请求关闭系统临时对话框时</td>
</tr>
<tr>
<td>ACTION_CONFIGURATION_CHANGED</td>
<td>设置改变时</td>
</tr>
<tr>
<td>ACTION_DATE_CHANGED</td>
<td>日期改变时</td>
</tr>
<tr>
<td>ACTION_DOCK_EVENT</td>
<td>更改设备物理对接状态时</td>
</tr>
<tr>
<td>ACTION_EXTERNAL_APPLICATIONS_AVAILABLE</td>
<td>一组包的资源目前可用</td>
</tr>
<tr>
<td>ACTION_EXTERNAL_APPLICATIONS_UNAVAILABLE</td>
<td>一组包的资源目前不可用</td>
</tr>
<tr>
<td>ACTION_GTALK_SERVICE_CONNECTED</td>
<td>已建立GTalk连接时</td>
</tr>
<tr>
<td>ACTION_GTALK_SERVICE_DISCONNECTED</td>
<td>停止GTalk连接时</td>
</tr>
<tr>
<td>ACTION_HEADSET_PLUG</td>
<td>有线耳机插入或拔出</td>
</tr>
<tr>
<td>ACTION_INPUT_METHOD_CHANGED</td>
<td>输入法改变时</td>
</tr>
<tr>
<td>ACTION_LOCALE_CHANGED</td>
<td>设备区域更改</td>
</tr>
<tr>
<td>ACTION_LOCKED_BOOT_COMPLETED</td>
<td>用户完成引导之后但仍处于 <code>locked</code> 状态时，只广播一次</td>
</tr>
<tr>
<td>ACTION_MANAGE_PACKAGE_STORAGE</td>
<td>处于用户设置的低内存条件时，应该启动 <code>package management</code></td>
</tr>
<tr>
<td>ACTION_MEDIA_BAD_REMOVAL</td>
<td>删除了SD卡中的额外介质但没有卸载挂载</td>
</tr>
<tr>
<td>ACTION_MEDIA_BUTTON</td>
<td>按下 <code>Media Button</code> 时</td>
</tr>
<tr>
<td>ACTION_MEDIA_CHECKING</td>
<td>存在外部介质，并进行检查时</td>
</tr>
<tr>
<td>ACTION_MEDIA_EJECT</td>
<td>用户希望移除存储介质时</td>
</tr>
<tr>
<td>ACTION_MEDIA_MOUNTED</td>
<td>外部介质存在且已挂载</td>
</tr>
<tr>
<td>ACTION_MEDIA_NOFS</td>
<td>存在外部介质，但使用的是不兼容的fs（或为空）</td>
</tr>
<tr>
<td>ACTION_MEDIA_REMOVED</td>
<td>外部介质被移除</td>
</tr>
<tr>
<td>ACTION_MEDIA_SCANNER_FINISHED</td>
<td><code>media scanner</code> 已经完成扫描目录</td>
</tr>
<tr>
<td>ACTION_MEDIA_SCANNER_SCAN_FILE</td>
<td>请求 <code>media scanner</code> 扫描文件并将其添加到媒体数据库</td>
</tr>
<tr>
<td>ACTION_PACKAGE_ADDED</td>
<td>成功安装应用程序时</td>
</tr>
<tr>
<td>ACTION_PACKAGE_REMOVED</td>
<td>成功移除应用程序时</td>
</tr>
<tr>
<td>ACTION_REBOOT</td>
<td>重新启动时</td>
</tr>
<tr>
<td>ACTION_SCREEN_OFF</td>
<td>系统睡眠时</td>
</tr>
<tr>
<td>ACTION_SCREEN_ON</td>
<td>系统被唤醒时</td>
</tr>
<tr>
<td>ACTION_SHUTDOWN</td>
<td>设备关机时</td>
</tr>
</tbody>
</table>
<p>Android 的广播分为静态注册和动态注册两种注册方式，动态注册的广播只存在于程序注册广播的生命周期中，也就是说只能在程序启动后才能收到广播，而静态广播可以在程序未被启动时即可监听。一般我们不推荐使用静态广播（占用内存影响效率），除非你真的需要。</p>
<h3 id="使用动态广播监听系统网络变化"><a href="#使用动态广播监听系统网络变化" class="headerlink" title="使用动态广播监听系统网络变化"></a>使用动态广播监听系统网络变化</h3><p><img src="https://s1.ax1x.com/2018/10/14/iUDBLQ.png" alt="创建"><br>创建一个 <code>NetworkChangeReceiver</code> ，他需要重载 <code>onReceive</code> 函数来实现收到广播后需要完成的事情。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetworkChangeReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        ConnectivityManager connectivityManager = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line"></span><br><span class="line">        NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();</span><br><span class="line">        <span class="keyword">if</span> (networkInfo != <span class="keyword">null</span> &amp;&amp; networkInfo.isConnected()) &#123;</span><br><span class="line">            Toast.makeText(context, <span class="string">"网络已经连接"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(context, <span class="string">"网络未连接"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>写好之后，不免会有疑问，这个广播接收器应该接收什么样的广播，怎么给他进行设置。答案就是通过 <code>intent-filter</code> 打开 <code>AndroidManifest.xml</code>，修改<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">".NetworkChangeReceiver"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:enabled</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>为<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">".NetworkChangeReceiver"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:enabled</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.net.conn.CONNECTIVITY_CHANGE"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>一开始的表格中的 <code>action name</code> 便是广播信息的标识，因为我们要监测网络变化，所以这里的 <code>action name</code> 我们填写 <code>android.net.conn.CONNECTIVITY_CHANGE</code> 。</p>
<p>接着我们只需要对广播接收器进行注册，广播接收器就能收到广播了。打开 <code>MainActivity.java</code>，重载如下方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> NetworkChangeReceiver networkChangeReceiver;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (networkChangeReceiver == <span class="keyword">null</span>) &#123;</span><br><span class="line">            networkChangeReceiver = <span class="keyword">new</span> NetworkChangeReceiver();</span><br><span class="line">        &#125;</span><br><span class="line">        IntentFilter intentFilter = <span class="keyword">new</span> IntentFilter();</span><br><span class="line">        intentFilter.addAction(ConnectivityManager.CONNECTIVITY_ACTION);</span><br><span class="line">        registerReceiver(networkChangeReceiver, intentFilter);</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        unregisterReceiver(networkChangeReceiver);</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>我们使用 <code>registerReceiver</code> 函数对广播接收器进行注册，其第一个参数是要进行注册的广播接收器，第二个参数是一个进行匹配的 <code>intent-filter</code>。<br>我们使用 <code>unregisterReceiver</code> 取消对广播接收器的注册，这样这个广播接收器将不再接收广播。</p>
<p>注册方法其实可以写在任意地方，重载这两个函数只是为了更好的利用资源（不妨想想这两个函数在activity生命周期何时运行），另外要记得执行 <code>unregisterReceiver</code> 取消注册，以防止内存泄露。</p>
<p><img src="https://s1.ax1x.com/2018/10/14/iUsZ36.png" alt="效果"></p>
<h2 id="下一篇"><a href="#下一篇" class="headerlink" title="下一篇"></a>下一篇</h2><p>在下一篇博客中，我们将学习静态注册以及有序广播。</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
            <category> 广播机制 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Broadcast </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[KMP算法]]></title>
      <url>http://blog.grapedge.top/2017/03/kmp-note/</url>
      <content type="html"><![CDATA[<p>KMP算法用于字符串匹配，算法复杂度为 $\Theta (N)$</p>
<a id="more"></a>
<h2 id="对称性"><a href="#对称性" class="headerlink" title="对称性"></a>对称性</h2><p>考虑目标串 <code>abcdabcdabfcd</code> 和模式串 <code>abcdabf</code>，可以发现当我们进行一次匹配后将在 <code>f</code> 处失配，在朴素算法中我们会将模式串后移一位重新匹配，但我们发现在模式串后面的 <code>ab</code> 和前面的 <code>ab</code> 是一样的，而 <code>ab</code> 在 <code>f</code> 之前已经匹配完成，所以我们可以直接将字符串匹配位置向后移动至 <code>ab</code> 处。</p>
<p><img src="http://om7xa3y58.bkt.clouddn.com/17-3-10/83726389-file_1489135419419_878d.png" alt="匹配示意图"></p>
<p>那么我们对于一个字符串只要知道其对称性就可以知道需要向后移动多少位。</p>
<h2 id="next数组"><a href="#next数组" class="headerlink" title="next数组"></a>next数组</h2><p>我们定义 <code>next数组</code> 中第 $i$ 个元素表示前 $i$ 个字符作为部分匹配串最长公共前后缀的长度，也就是我们之前提到的对称性。</p>
<p>例如对于前面提到的模式串，其next数组的值，</p>
<table>
<thead>
<tr>
<th>a</th>
<th>b</th>
<th>c</th>
<th>d</th>
<th>a</th>
<th>b</th>
<th>f</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>0</td>
</tr>
</tbody>
</table>
<h3 id="递推求解next"><a href="#递推求解next" class="headerlink" title="递推求解next"></a>递推求解next</h3><ul>
<li>如果 $next[i-1]$ 不为 $0$，并且当前字符与第 $next[i-1] + 1$ 个字符不相等，那么继续对比 $next[next[i-1]] + 1$个字符直至找到 $-1$；</li>
<li>否则如果当前字符与第 $next[i-1] + 1$ 个字符相等，那么 $next[i] = next[i-1]+1$</li>
</ul>
<h2 id="匹配"><a href="#匹配" class="headerlink" title="匹配"></a>匹配</h2><ul>
<li>如果当前字符匹配，继续匹配下一个字符；</li>
<li>如果当前字符不匹配，使当前模式串的前缀和目标串的匹配后缀对其。</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1008611</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> target[MAXN + <span class="number">7</span>], pattern[MAXN + <span class="number">7</span>];</span><br><span class="line"><span class="keyword">int</span> next [MAXN + <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">KMP</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> tl = <span class="built_in">strlen</span> (target), pl = <span class="built_in">strlen</span> (pattern);</span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">	next[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j; i &lt;= pl; next[i] = j + <span class="number">1</span>, i++) <span class="keyword">for</span> (j = next[i - <span class="number">1</span>]; j != <span class="number">-1</span> &amp;&amp; pattern[j] != pattern[i - <span class="number">1</span>]; j = next[j]);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; tl; i++, j++, j == pl ? count ++ : <span class="number">0</span>) <span class="keyword">for</span> (; j != <span class="number">-1</span> &amp;&amp; pattern[j] != target[i]; j = next[j]);</span><br><span class="line">	<span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span> (<span class="string">"%s%s"</span>, pattern, target), <span class="built_in">printf</span> (<span class="string">"%d\n"</span>, KMP ());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 字符串 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[图的割边]]></title>
      <url>http://blog.grapedge.top/2017/03/cut-edge/</url>
      <content type="html"><![CDATA[<p>对于连通图 <code>G</code>，若删除其中的一条边 <code>e</code>，原图不再连通，则 <code>e</code> 是图 <code>G</code> 的一条割边。一个图可能有多条割边。</p>
<a id="more"></a>
<p><img src="http://om7xa3y58.bkt.clouddn.com/17-3-4/5706183-file_1488608690628_e09c.png" alt=""></p>
<h2 id="Tarjan算法"><a href="#Tarjan算法" class="headerlink" title="Tarjan算法"></a>Tarjan算法</h2><p>类似于求解有向图强连通分量的 <code>Tarjan算法</code>， 我们定义</p>
<ul>
<li>$ dfn (u) $ 表示在搜索树中访问到结点 <code>u</code> 的时间戳；</li>
<li>$ low (u) $ 表示从结点 <code>u</code> 开始搜索，在搜索树上是 <code>u</code> 的祖先且 $ dfn(u) $ 最小的结点。</li>
</ul>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>对于搜索树上的边 $ (u, v) $，如果 $ dfn (u) &lt; low (v) $，则这条边是割边。 $ dfn (u) &lt; low (v) $，即点 <code>v</code> 无法通过其他边访问到 <code>u</code> 的祖先。需要注意的是对于重边的处理，一般将一条无向边拆为两条有向边，但在遍历时只访问其一条边，例如无向边 $ (u, v) $ 可以分解为有向边 $ (u, v) $ 和 有向边 $ (v, u) $，在从结点 <code>u</code> 进行搜索时通过有向边 $ (u, v) $ 访问到结点 <code>v</code>，但在访问结点 <code>v</code> 时就不再通过有向边 $ (v, u) $ 访问结点 <code>u</code> （相当于直接访问原图的无向边），而如果有重边，便会由另一条有向边 $ (v, u) $ 访问到 结点 <code>u</code>， 这样会出现 $ dfn (u) \geq low (v) $，也就不是割边了。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 待更...</span></span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tarjan </tag>
            
            <tag> 图论 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[图的割点]]></title>
      <url>http://blog.grapedge.top/2017/03/cut-vertex/</url>
      <content type="html"><![CDATA[<p>定义：对于无向图 <code>G</code> ，如果删除某个顶点 <code>u</code> 之后，连通分量的数目增加，则称 <code>u</code> 为图的割点。一个图可能有多个割点。<br><a id="more"></a></p>
<h2 id="Tarjan算法"><a href="#Tarjan算法" class="headerlink" title="Tarjan算法"></a>Tarjan算法</h2><p>类似于求解有向图强连通分量的 <code>Tarjan算法</code>， 我们定义</p>
<ul>
<li>$ dfn (u) $ 表示在搜索树中访问到结点 <code>u</code> 的时间戳；</li>
<li>$ low (u) $ 表示从结点 <code>u</code> 开始搜索，在搜索树上是 <code>u</code> 的祖先且 $ dfn(u) $ 最小的结点。</li>
</ul>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><ul>
<li>对于搜索树上的根结点，如果它有两个或更多的子结点，那么它是割点；</li>
<li>对于搜索树上的非根结点，如果存在子结点 <code>v</code> 使得 $ dfn (u) \geq low (v)$，也就是 <code>v</code> 向上无法达到 <code>u</code> 的父结点，那么它是割点。<br><img src="http://om7xa3y58.bkt.clouddn.com/17-3-3/68328322-file_1488510241008_9bee.png" alt="cutVertex"></li>
</ul>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 递归版</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> dfn, low, childCnt;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> *<span class="title">edges</span>;</span></span><br><span class="line">	Node *father;</span><br><span class="line">	<span class="keyword">bool</span> vis, isCut;</span><br><span class="line">&#125; nodes[MAXN + <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	Node *from, *to;</span><br><span class="line">	Edge *next;</span><br><span class="line">	Edge (Node *u, Node *v) : from (u), to (v), next (u-&gt;edges) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> s, <span class="keyword">const</span> <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	nodes[s].edges = <span class="keyword">new</span> Edge (nodes + s, nodes + t);</span><br><span class="line">	nodes[t].edges = <span class="keyword">new</span> Edge (nodes + t, nodes + s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, ans = <span class="number">0</span>, timeStamp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Tarjan</span> <span class="params">(Node *v)</span> </span>&#123;</span><br><span class="line">	v-&gt;vis = <span class="literal">true</span>;</span><br><span class="line">	v-&gt;dfn = v-&gt;low = timeStamp++;</span><br><span class="line">	<span class="keyword">int</span> childCnt = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (Edge *e = v-&gt;edges; e; e = e-&gt;next) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!e-&gt;to-&gt;vis) &#123;</span><br><span class="line">			e-&gt;to-&gt;father = v;</span><br><span class="line">			Tarjan (e-&gt;to);</span><br><span class="line">			v-&gt;low = <span class="built_in">std</span>::min (v-&gt;low, e-&gt;to-&gt;low);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (v-&gt;father) &#123;</span><br><span class="line">				<span class="keyword">if</span> (e-&gt;to-&gt;low &gt;= v-&gt;dfn) v-&gt;isCut = <span class="literal">true</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (++childCnt == <span class="number">2</span>) v-&gt;isCut = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			v-&gt;low = <span class="built_in">std</span>::min (v-&gt;low, e-&gt;to-&gt;dfn);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, u, v; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;u, &amp;v), --u, --v;</span><br><span class="line">		AddEdge (u, v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!nodes[i].vis) Tarjan (nodes + i);</span><br><span class="line">		<span class="keyword">if</span> (nodes[i].isCut) <span class="built_in">printf</span> (<span class="string">"%d "</span>, i), ans++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">"%d\n"</span>, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">20000</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> dfn, low, childCnt;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> *<span class="title">edges</span>;</span></span><br><span class="line">	Node *father;</span><br><span class="line">	<span class="keyword">bool</span> vis, isCut;</span><br><span class="line">&#125; nodes[MAXN + <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	Node *from, *to;</span><br><span class="line">	Edge *next;</span><br><span class="line">	Edge (Node *u, Node *v) : from (u), to (v), next (u-&gt;edges) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> s, <span class="keyword">const</span> <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	nodes[s].edges = <span class="keyword">new</span> Edge (nodes + s, nodes + t);</span><br><span class="line">	nodes[t].edges = <span class="keyword">new</span> Edge (nodes + t, nodes + s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">StackInfo</span> &#123;</span></span><br><span class="line">	Node *v;</span><br><span class="line">	Edge *e;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Setup</span> <span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">		v = x;</span><br><span class="line">		e = v-&gt;edges;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; dfsInfo[MAXN], *tail = dfsInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">stack</span>&lt;StackInfo *&gt; infoStack;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Tarjan</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> timeStamp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="keyword">if</span> (!nodes[i].vis) &#123;</span><br><span class="line">		tail-&gt;Setup (nodes + i);</span><br><span class="line">		infoStack.push (tail++);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (!infoStack.empty ()) &#123;</span><br><span class="line">			StackInfo *info = infoStack.top ();</span><br><span class="line">			Node *v = info-&gt;v;</span><br><span class="line">			<span class="keyword">if</span> (!v-&gt;vis) &#123;</span><br><span class="line">				v-&gt;vis = <span class="literal">true</span>;</span><br><span class="line">				v-&gt;dfn = v-&gt;low = timeStamp++;</span><br><span class="line">			&#125;</span><br><span class="line">			Edge *&amp;e = info-&gt;e;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (e) &#123;</span><br><span class="line">				<span class="keyword">if</span> (!e-&gt;to-&gt;vis) &#123;</span><br><span class="line">					e-&gt;to-&gt;father = v;</span><br><span class="line">					tail-&gt;Setup (e-&gt;to);</span><br><span class="line">					infoStack.push (tail++);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					v-&gt;low = <span class="built_in">std</span>::min (v-&gt;low, e-&gt;to-&gt;dfn);</span><br><span class="line">				&#125;</span><br><span class="line">				e = e-&gt;next;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (v-&gt;father) &#123;</span><br><span class="line">					v-&gt;father-&gt;low = <span class="built_in">std</span>::min (v-&gt;father-&gt;low, v-&gt;low);</span><br><span class="line">					<span class="keyword">if</span> (v-&gt;father-&gt;father) &#123;</span><br><span class="line">						<span class="keyword">if</span> (v-&gt;low &gt;= v-&gt;father-&gt;dfn) v-&gt;father-&gt;isCut = <span class="literal">true</span>;</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						<span class="keyword">if</span> (++v-&gt;father-&gt;childCnt == <span class="number">2</span>) v-&gt;father-&gt;isCut = <span class="literal">true</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				infoStack.pop ();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, u, v; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;u, &amp;v), --u, --v;</span><br><span class="line">		AddEdge (u, v);</span><br><span class="line">	&#125;</span><br><span class="line">	Tarjan ();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (nodes[i].isCut) ans++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">"%d\n"</span>, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tarjan </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Tarjan 算法]]></title>
      <url>http://blog.grapedge.top/2017/03/tarjan-note/</url>
      <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><code>Tarjan</code> 用于求解 <code>有向图</code> 的强连通分量。在有向图 <code>G</code> 中如果两个顶点 <code>u</code>、 <code>v</code> 之间相互可达，则称这两个点是强连通的。若 <code>G</code> 中任意两点是强连通的，则称图 <code>G</code> 是 <code>强连通图</code>。有向非强连通图的<strong>极大强连通子图</strong>称为强连通分量。极大的意义是，对于图 <code>G</code> 的一个极大强连通子图 <code>K</code>，当我们将原图 <code>G</code> 中任意一个非 <code>K</code> 结点加入 <code>K</code> 后，<code>K</code> 不再是一个强连通图。<br><a id="more"></a></p>
<h2 id="求解"><a href="#求解" class="headerlink" title="求解"></a>求解</h2><p><code>Tarjan算法</code> 的核心是对图 <code>G</code> 进行一遍深度优先搜索。强连通分量一定在当前搜索树的子树中。</p>
<h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><ul>
<li>定义 $ dfn(u) $ 表示在搜索时访问到结点 <code>u</code> 的时间戳，即 <code>u</code> 是第几个被搜索到的；</li>
<li>定义 $ low(u) $ 表示从结点 <code>u</code> 开始搜索，在搜索树上<strong>是 <code>u</code> 的祖先且 $ dfn(u) $ 最小</strong>的结点。</li>
</ul>
<p>根据这些定义，我们可以发现，在遍历完结点 <code>u</code> 的所有邻接点后，如果 $ dfn (u) = low (u) $ , 那么以 <code>u</code> 为起点的搜索子树即一个强连通分量。</p>
<h3 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h3><p>我们在实现时将构造一个栈，在这个栈中存放当前搜索树上的结点，即当我们访问到一个点时将该点放入栈中。<br>计算 $low(u)$：</p>
<ul>
<li>如果邻接点 <code>v</code> 在栈中，也就是说该点是结点 <code>u</code> 的祖先，更新<br>$$ low (u) = \min (low (u), dfn (v)) $$</li>
<li>如果邻接点 <code>v</code> 没有被访问过，那么对 <code>v</code> 进行遍历，并在回溯后更新<br>$$ low (u) = \min (low (u), low (v)) $$</li>
</ul>
<p>特别地，当邻接点 <code>v</code> 被访问过但不在栈中时我们不进行更新，因为此时结点 <code>v</code> 不是结点 <code>u</code> 的祖先，所以他们更不可能属于一个强连通分量</p>
<p>算法的时间复杂度为 $\Theta(N + M)$</p>
<h3 id="特别"><a href="#特别" class="headerlink" title="特别"></a>特别</h3><p><code>Tarjan</code> 在实际应用中一般写为非递归形式，这是为了防止栈溢出。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1e5</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> *<span class="title">edges</span>;</span></span><br><span class="line">	<span class="keyword">int</span> dfn, low;</span><br><span class="line">	<span class="keyword">bool</span> inStack, vis;</span><br><span class="line">	Node () : edges (<span class="literal">NULL</span>), dfn (<span class="number">0</span>), low (<span class="number">0</span>), inStack (<span class="literal">false</span>), vis (<span class="literal">false</span>) &#123;&#125;</span><br><span class="line">&#125; nodes[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	Node *from, *to;</span><br><span class="line">	Edge *next;</span><br><span class="line">	Edge (Node *u, Node *v) : from (u), to (v), next (from-&gt;edges) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> s, <span class="keyword">const</span> <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	nodes[s].edges = <span class="keyword">new</span> Edge (nodes + s, nodes + t);</span><br><span class="line">	<span class="comment">//nodes[t].edges = new Edge (nodes + t, nodes + s);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DFSInfo</span> &#123;</span></span><br><span class="line">	Node *v;</span><br><span class="line">	Edge *e, *inEdge;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Setup</span> <span class="params">(Node *x, Edge *fr = <span class="literal">NULL</span>)</span> </span>&#123;</span><br><span class="line">		v = x;</span><br><span class="line">		e = v-&gt;edges;</span><br><span class="line">		inEdge = fr;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; dfsInfo[MAXN], *tail = dfsInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, ans = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">stack</span>&lt;Node*&gt; tarjanStack;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">stack</span>&lt;DFSInfo*&gt; infoStack;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Tarjan</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> timeStamp = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="keyword">if</span> (!nodes[i].vis) &#123;</span><br><span class="line">		tail-&gt;Setup (nodes + i);</span><br><span class="line">		infoStack.push (tail++);</span><br><span class="line">		<span class="keyword">while</span> (!infoStack.empty ()) &#123;</span><br><span class="line">			DFSInfo *info = infoStack.top ();</span><br><span class="line">			Node *v = info-&gt;v;</span><br><span class="line">			<span class="keyword">if</span> (!v-&gt;vis) &#123;</span><br><span class="line">				v-&gt;vis = <span class="literal">true</span>;</span><br><span class="line">				v-&gt;dfn = v-&gt;low = timeStamp++;</span><br><span class="line">				v-&gt;inStack = <span class="literal">true</span>;</span><br><span class="line">				tarjanStack.push (v);</span><br><span class="line">			&#125;</span><br><span class="line">			Edge *&amp;e = info-&gt;e;</span><br><span class="line">			<span class="keyword">if</span> (e != <span class="literal">NULL</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (e-&gt;to-&gt;inStack) &#123;</span><br><span class="line">					v-&gt;low = <span class="built_in">std</span>::min (v-&gt;low, e-&gt;to-&gt;dfn);</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!e-&gt;to-&gt;vis) &#123;</span><br><span class="line">					tail-&gt;Setup (e-&gt;to, e);</span><br><span class="line">					infoStack.push (tail++);</span><br><span class="line">				&#125;</span><br><span class="line">				e = e-&gt;next;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (v-&gt;low == v-&gt;dfn) &#123;</span><br><span class="line">				    <span class="comment">// 以下属于同一强连通分量</span></span><br><span class="line">					<span class="keyword">for</span> (Node *u = tarjanStack.top (); ; u = tarjanStack.top ()) &#123;</span><br><span class="line">						u-&gt;inStack = <span class="literal">false</span>;</span><br><span class="line">						tarjanStack.pop ();</span><br><span class="line">						<span class="keyword">if</span> (u == v) <span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">					ans++;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (info-&gt;inEdge != <span class="literal">NULL</span>) &#123;</span><br><span class="line">					info-&gt;inEdge-&gt;from-&gt;low = <span class="built_in">std</span>::min (info-&gt;inEdge-&gt;from-&gt;low, v-&gt;low);</span><br><span class="line">				&#125;</span><br><span class="line">				infoStack.pop ();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, u, v; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">		AddEdge (--u, --v);</span><br><span class="line">	&#125;</span><br><span class="line">	Tarjan ();</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">"%d"</span>, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tarjan </tag>
            
            <tag> 图论 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[树链剖分]]></title>
      <url>http://blog.grapedge.top/2017/01/chain-split/</url>
      <content type="html"><![CDATA[<p>树链剖分常用于解决静态树上路径信息维护的问题，例如修改树上某条路径中所有结点的值，或是查询某路径中所有结点的和。假如说该树退化为一条链，这便成了区间修改、区间查询问题。如果我们能将树上的点按照某种方式组织起来，剖分成若干条链，则每条链相当于一个区间，此时便可用一些其他数据结构进行维护。</p>
<a id="more"></a>
<h2 id="轻重边剖分"><a href="#轻重边剖分" class="headerlink" title="轻重边剖分"></a>轻重边剖分</h2><p>定义 $size (u)$ 表示以 $u$ 为根的子树结点数目。<br><img src="http://om7xa3y58.bkt.clouddn.com/17-3-18/61401530-file_1489824077383_ed0d.png" alt=""></p>
<p>令 $v$ 为 $u$ 所有儿子结点中 $size$ 值最大的一个结点，则 $(u, v)$ 为重边，其他边为轻边。</p>
<h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><ul>
<li>如果 $(u, v)$ 为轻边，则 $size (v) \leq size (u) \div 2$；</li>
<li>从根到某一结点 $v$ 的路径上轻边、重路径的个数不大于 $\log_2N$ ；</li>
</ul>
<p>其中重路径的定义为全部由重边构成的路径。<br>容易发现，一个点在且仅在一条重路径上。</p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>考虑操作路径 $(u,v)$ ，我们可以分别处理他们到他们的最近公共祖先的路径。根据性质 2 我们可以知道路径最多分解最多 $O(log_2N)$ 条重路径和 $O(log_2N)$ 条轻边。对于重路径，他们相当于一个序列，所以我们可以直接用线段树等数据结构进行维护。而对于轻边我们可以直接跳过，因为轻边的两端点一定在某两条重路径上（单个结点也可以构成一条重路径），总时间复杂度为 $\Theta (M\log_2^2N)$</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>轻重链剖分通过两次 <code>dfs</code> 实现，第一次求出每个结点的 $size$ 和 该结点的最大子树以及该结点的深度，第二次求出每个点所在的链以及其 <code>dfn</code> 的值。</p>
<p>我们要用到的 <code>dfn</code> ，实际上就是这个结点在剖分完之后对应的线段树中序列的编号，因此我们在实现的时候要优先访问最大子树的结点，以保证一条重路径上的点的 <code>dfn</code> 序相邻。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (v-&gt;maxChild) DFS_2 (v-&gt;maxChild); 		<span class="comment">// 保证一条重路径上的dfn序相邻</span></span><br></pre></td></tr></table></figure>
<p>在求链的时候我们会记录这条链的顶端点，也就是这条链中深度最低的点，这样我们就可以方便的对每一条链上进行求值。例如在进行求和 $(a,b)$ 操作：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">QuerySum</span> <span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	Node *u = nodes + a, *v = nodes + b;</span><br><span class="line">	<span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (u-&gt;chain != v-&gt;chain) &#123;</span><br><span class="line">		<span class="keyword">if</span> (u-&gt;chain-&gt;top-&gt;depth &lt; v-&gt;chain-&gt;top-&gt;depth) <span class="built_in">std</span>::swap (u, v);</span><br><span class="line">		res += segt-&gt;QuerySum (u-&gt;chain-&gt;top-&gt;dfn, u-&gt;dfn);</span><br><span class="line">		u = u-&gt;chain-&gt;top-&gt;father;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (u-&gt;depth &gt; v-&gt;depth) <span class="built_in">std</span>::swap (u, v);</span><br><span class="line">	res += segt-&gt;QuerySum (u-&gt;dfn, v-&gt;dfn);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="树的统计"><a href="#树的统计" class="headerlink" title="树的统计"></a>树的统计</h2><p>这是一道树链剖分模板题，单点修改，区间查询。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">300000</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> *<span class="title">edges</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Chain</span> *<span class="title">chain</span>;</span></span><br><span class="line">	Node *father, *maxChild;</span><br><span class="line">	<span class="keyword">int</span> size, dfn, depth;</span><br><span class="line">	<span class="keyword">bool</span> vis;</span><br><span class="line">&#125; nodes[MAXN + <span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	Node *from, *to;</span><br><span class="line">	Edge *next;</span><br><span class="line">	Edge (Node *from, Node *to) : from (from), to (to), next (from-&gt;edges) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Chain</span> &#123;</span></span><br><span class="line">	Node *top;</span><br><span class="line">	Chain (Node *top) : top (top) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> s, <span class="keyword">const</span> <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	nodes[s].edges = <span class="keyword">new</span> Edge (nodes + s, nodes + t);</span><br><span class="line">	nodes[t].edges = <span class="keyword">new</span> Edge (nodes + t, nodes + s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">DFS_1</span> <span class="params">(Node *v)</span> </span>&#123;</span><br><span class="line">	v-&gt;vis = <span class="literal">true</span>;</span><br><span class="line">	v-&gt;size = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (Edge *e = v-&gt;edges; e; e = e-&gt;next) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!e-&gt;to-&gt;vis) &#123;</span><br><span class="line">			e-&gt;to-&gt;father = v;</span><br><span class="line">			e-&gt;to-&gt;depth = v-&gt;depth + <span class="number">1</span>;</span><br><span class="line">			DFS_1 (e-&gt;to);</span><br><span class="line">			v-&gt;size += e-&gt;to-&gt;size;</span><br><span class="line">			<span class="keyword">if</span> (!v-&gt;maxChild || e-&gt;to-&gt;size &gt; v-&gt;maxChild-&gt;size) v-&gt;maxChild = e-&gt;to;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">DFS_2</span> <span class="params">(Node *v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> ts = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	v-&gt;dfn = ++ts;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!v-&gt;father || v != v-&gt;father-&gt;maxChild) v-&gt;chain = <span class="keyword">new</span> Chain (v);</span><br><span class="line">	<span class="keyword">else</span> v-&gt;chain = v-&gt;father-&gt;chain;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (v-&gt;maxChild) DFS_2 (v-&gt;maxChild); 		<span class="comment">// 保证一条重路径上的dfn序相邻</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (Edge *e = v-&gt;edges; e; e = e-&gt;next) &#123;</span><br><span class="line">		<span class="keyword">if</span> (e-&gt;to-&gt;father == v &amp;&amp; e-&gt;to != v-&gt;maxChild) DFS_2 (e-&gt;to);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Split</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	nodes[<span class="number">1</span>].depth = <span class="number">1</span>;</span><br><span class="line">	DFS_1 (nodes + <span class="number">1</span>);</span><br><span class="line">	DFS_2 (nodes + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> l, r, mid;</span><br><span class="line">	SegmentTree *lc, *rc;</span><br><span class="line">	<span class="keyword">int</span> sum, max;</span><br><span class="line"></span><br><span class="line">	SegmentTree (<span class="keyword">int</span> l, <span class="keyword">int</span> r, SegmentTree *lc, SegmentTree *rc) : l (l), r (r), mid (l + (r - l) / <span class="number">2</span>), lc (lc), rc (rc), sum (<span class="number">0</span>), max (INT_MAX) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Maintain</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">		sum = lc-&gt;sum + rc-&gt;sum;</span><br><span class="line">		max = <span class="built_in">std</span>::max (lc-&gt;max, rc-&gt;max);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> <span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (l == r) sum = max = x;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (pos &lt;= mid) lc-&gt;Update (pos, x), Maintain ();</span><br><span class="line">		<span class="keyword">else</span> rc-&gt;Update (pos, x), Maintain ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">QuerySum</span> <span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;l &gt; r || <span class="keyword">this</span>-&gt;r &lt; l) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (l &lt;= <span class="keyword">this</span>-&gt;l &amp;&amp; r &gt;= <span class="keyword">this</span>-&gt;r) <span class="keyword">return</span> sum;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> lc-&gt;QuerySum (l, r) + rc-&gt;QuerySum (l, r);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">QueryMax</span> <span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;l &gt; r || <span class="keyword">this</span>-&gt;r &lt; l) <span class="keyword">return</span> INT_MIN;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (l &lt;= <span class="keyword">this</span>-&gt;l &amp;&amp; r &gt;= <span class="keyword">this</span>-&gt;r) <span class="keyword">return</span> max;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">std</span>::max (lc-&gt;QueryMax (l, r), rc-&gt;QueryMax (l, r));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> SegmentTree *<span class="title">Build</span> <span class="params">(<span class="keyword">int</span> l, i#include &lt;cstdio&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">#include &lt;algorithm&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">#include &lt;climits&gt;</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">300000</span>;</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">struct Node &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">	struct Edge *edges;</span></span></span><br><span class="line"><span class="function"><span class="params">	struct Chain *chain;</span></span></span><br><span class="line"><span class="function"><span class="params">	Node *father, *maxChild;</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">int</span> size, dfn, depth;</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">bool</span> vis;</span></span></span><br><span class="line"><span class="function"><span class="params">&#125; nodes[MAXN + <span class="number">7</span>];</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">struct Edge &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">	Node *from, *to;</span></span></span><br><span class="line"><span class="function"><span class="params">	Edge *next;</span></span></span><br><span class="line">	Edge (Node *from, Node *to) : from (from), to (to), next (from-&gt;edges) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Chain</span> &#123;</span></span><br><span class="line">	Node *top;</span><br><span class="line">	Chain (Node *top) : top (top) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> s, <span class="keyword">const</span> <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	nodes[s].edges = <span class="keyword">new</span> Edge (nodes + s, nodes + t);</span><br><span class="line">	nodes[t].edges = <span class="keyword">new</span> Edge (nodes + t, nodes + s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">DFS_1</span> <span class="params">(Node *v)</span> </span>&#123;</span><br><span class="line">	v-&gt;vis = <span class="literal">true</span>;</span><br><span class="line">	v-&gt;size = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (Edge *e = v-&gt;edges; e; e = e-&gt;next) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!e-&gt;to-&gt;vis) &#123;</span><br><span class="line">			e-&gt;to-&gt;father = v;</span><br><span class="line">			e-&gt;to-&gt;depth = v-&gt;depth + <span class="number">1</span>;</span><br><span class="line">			DFS_1 (e-&gt;to);</span><br><span class="line">			v-&gt;size += e-&gt;to-&gt;size;</span><br><span class="line">			<span class="keyword">if</span> (!v-&gt;maxChild || e-&gt;to-&gt;size &gt; v-&gt;maxChild-&gt;size) v-&gt;maxChild = e-&gt;to;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">DFS_2</span> <span class="params">(Node *v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> ts = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	v-&gt;dfn = ++ts;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!v-&gt;father || v != v-&gt;father-&gt;maxChild) v-&gt;chain = <span class="keyword">new</span> Chain (v);</span><br><span class="line">	<span class="keyword">else</span> v-&gt;chain = v-&gt;father-&gt;chain;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (v-&gt;maxChild) DFS_2 (v-&gt;maxChild); 		<span class="comment">// 保证一条重路径上的dfn序相邻</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (Edge *e = v-&gt;edges; e; e = e-&gt;next) &#123;</span><br><span class="line">		<span class="keyword">if</span> (e-&gt;to-&gt;father == v &amp;&amp; e-&gt;to != v-&gt;maxChild) DFS_2 (e-&gt;to);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Split</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	nodes[<span class="number">1</span>].depth = <span class="number">1</span>;</span><br><span class="line">	DFS_1 (nodes + <span class="number">1</span>);</span><br><span class="line">	DFS_2 (nodes + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SegmentTree</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> l, r, mid;</span><br><span class="line">	SegmentTree *lc, *rc;</span><br><span class="line">	<span class="keyword">int</span> sum, max;</span><br><span class="line"></span><br><span class="line">	SegmentTree (<span class="keyword">int</span> l, <span class="keyword">int</span> r, SegmentTree *lc, SegmentTree *rc) : l (l), r (r), mid (l + (r - l) / <span class="number">2</span>), lc (lc), rc (rc), sum (<span class="number">0</span>), max (INT_MAX) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Maintain</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">		sum = lc-&gt;sum + rc-&gt;sum;</span><br><span class="line">		max = <span class="built_in">std</span>::max (lc-&gt;max, rc-&gt;max);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> <span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (l == r) sum = max = x;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (pos &lt;= mid) lc-&gt;Update (pos, x), Maintain ();</span><br><span class="line">		<span class="keyword">else</span> rc-&gt;Update (pos, x), Maintain ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">QuerySum</span> <span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;l &gt; r || <span class="keyword">this</span>-&gt;r &lt; l) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (l &lt;= <span class="keyword">this</span>-&gt;l &amp;&amp; r &gt;= <span class="keyword">this</span>-&gt;r) <span class="keyword">return</span> sum;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> lc-&gt;QuerySum (l, r) + rc-&gt;QuerySum (l, r);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">QueryMax</span> <span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;l &gt; r || <span class="keyword">this</span>-&gt;r &lt; l) <span class="keyword">return</span> INT_MIN;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (l &lt;= <span class="keyword">this</span>-&gt;l &amp;&amp; r &gt;= <span class="keyword">this</span>-&gt;r) <span class="keyword">return</span> max;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">std</span>::max (lc-&gt;QueryMax (l, r), rc-&gt;QueryMax (l, r));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> SegmentTree *<span class="title">Build</span> <span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">return</span> l == r ? <span class="keyword">new</span> SegmentTree (l, r, <span class="literal">NULL</span>, <span class="literal">NULL</span>) : <span class="keyword">new</span> SegmentTree (l, r, Build (l, mid), Build (mid + <span class="number">1</span>, r));</span><br><span class="line">	&#125;</span><br><span class="line">&#125; *segt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Update</span> <span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	segt-&gt;Update (nodes[u].dfn, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">QuerySum</span> <span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	Node *u = nodes + a, *v = nodes + b;</span><br><span class="line">	<span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (u-&gt;chain != v-&gt;chain) &#123;</span><br><span class="line">		<span class="keyword">if</span> (u-&gt;chain-&gt;top-&gt;depth &lt; v-&gt;chain-&gt;top-&gt;depth) <span class="built_in">std</span>::swap (u, v);</span><br><span class="line">		res += segt-&gt;QuerySum (u-&gt;chain-&gt;top-&gt;dfn, u-&gt;dfn);</span><br><span class="line">		u = u-&gt;chain-&gt;top-&gt;father;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (u-&gt;depth &gt; v-&gt;depth) <span class="built_in">std</span>::swap (u, v);</span><br><span class="line">	res += segt-&gt;QuerySum (u-&gt;dfn, v-&gt;dfn);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">QueryMax</span> <span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	Node *u = nodes + a, *v = nodes + b;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> res = INT_MIN;</span><br><span class="line">	<span class="keyword">while</span> (u-&gt;chain != v-&gt;chain) &#123;</span><br><span class="line">		<span class="keyword">if</span> (u-&gt;chain-&gt;top-&gt;depth &lt; v-&gt;chain-&gt;top-&gt;depth) <span class="built_in">std</span>::swap (u, v);</span><br><span class="line">		res = <span class="built_in">std</span>::max (res, segt-&gt;QueryMax (u-&gt;chain-&gt;top-&gt;dfn, u-&gt;dfn));</span><br><span class="line">		u = u-&gt;chain-&gt;top-&gt;father;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// change to dfn?</span></span><br><span class="line">	<span class="keyword">if</span> (u-&gt;depth &gt; v-&gt;depth) <span class="built_in">std</span>::swap (u, v);</span><br><span class="line">	res = <span class="built_in">std</span>::max (res, segt-&gt;QueryMax (u-&gt;dfn, v-&gt;dfn));</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n, q;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, u, v; i &lt; n; i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">		AddEdge (u, v);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	Split ();</span><br><span class="line"></span><br><span class="line">	segt = SegmentTree::Build (<span class="number">1</span>, n);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, x; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d"</span>, &amp;x);</span><br><span class="line">		Update (i, x);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">char</span> cmd[<span class="number">15</span>];</span><br><span class="line">	<span class="keyword">int</span> a, b;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d"</span>, &amp;q);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (q--) &#123;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%s%d%d"</span>, cmd, &amp;a, &amp;b);</span><br><span class="line">		<span class="keyword">if</span> (cmd[<span class="number">1</span>] == <span class="string">'H'</span>) Update (a, b);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (cmd[<span class="number">1</span>] == <span class="string">'S'</span>) <span class="built_in">printf</span> (<span class="string">"%d\n"</span>, QuerySum (a, b));</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">printf</span> (<span class="string">"%d\n"</span>, QueryMax (a, b));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 树链剖分 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[「UVa679」Dropping Balls]]></title>
      <url>http://blog.grapedge.top/2016/11/dropping-balls/</url>
      <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>有一棵具有 $2^D-1$ 个节点的二叉树， $I$ 个小球，每个节点是一个开关，默认为关，小球每到一个点上会改变该点的状态为相反的状态，若此时开关为开则向左移动，若为关则向右移动。问第 $I$ 个小球最终会下落到几号节点。</p>
<a id="more"></a>
<p><img src="http://oed2kdm1n.bkt.clouddn.com/public/16-11-13/60627182.jpg" alt=""></p>
<p><a href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=620" target="_blank" rel="noopener">题目链接</a></p>
<p>如图，$D = 4$，$I = 2$，第 $1$ 个小球会经过 $1, 2, 4, 8$，第 $2$ 个小球会经过 $1,3，6，12$ 从而最终到达 $12$ 号点。</p>
<h2 id="暴力模拟"><a href="#暴力模拟" class="headerlink" title="暴力模拟"></a>暴力模拟</h2><p>很自然可以想到进行暴力模拟，每到达一个节点就改变该点的开关状态。这样每组数据可以达到 $2 ^ {19} \times 19$ 次运算，最多<strong>仅</strong>有 $1000$ 组数据，所以暴力会 <code>TLE</code>，如果你这么做了，你可能会看见下面的这张图：</p>
<p><img src="http://oed2kdm1n.bkt.clouddn.com/public/16-11-13/24913592.jpg" alt="Tear"></p>
<p><del>另外不要问我这张图怎么来的</del></p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>考虑对于根节点及其左右子树，如果当前的小球是<strong>第</strong>奇数次个到达根节点，那么它肯定要向左走，否则向右走（开关只有两种状态…）。推广到其他节点，如果这个小球是第奇数个到达这个节点，那么相应的这个开关目前处于开启状态，否则处于关闭状态。如果当前小球编号为 $I$，那么它是第 $I / 2$ 或 $(I + 1) / 2$个到达子节点的小球（画一画就出来了）。</p>
<p>简单的说，就是知道小球编号的奇偶性就能知道下一步是向左走还是向右走了。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> t, n, d, ans;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d"</span>, &amp;t);</span><br><span class="line">	<span class="keyword">while</span> (t--) &#123;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d %d"</span>, &amp;d, &amp;n);</span><br><span class="line">		ans = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt; d; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (n % <span class="number">2</span>) &#123;</span><br><span class="line">				ans = ans * <span class="number">2</span>, n = (n + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				ans = ans * <span class="number">2</span> + <span class="number">1</span>, n = n / <span class="number">2</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span> (<span class="string">"%d\n"</span>, ans);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 二叉树 </tag>
            
            <tag> UVa </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[左偏树]]></title>
      <url>http://blog.grapedge.top/2016/11/left-tree/</url>
      <content type="html"><![CDATA[<p>左偏树是一种可并堆，这使得他满足堆的性质，也能在 $\Theta (\log_2N)$ 的时间内合并两个堆。</p>
<a id="more"></a>
<p>除了堆中应存储的键值、左右子树之外，左偏树还保存一个距离值 <code>dist</code>，这表示结点到他子树中第一个外结点所经过的边数。其中外结点的定义为左子树或右子树为空的结点。</p>
<h2 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h2><ul>
<li>结点的键值小于或等于其左右子树的键值，也就是堆性质。</li>
<li>结点的左子结点的 <code>dist</code> 值不小于其右子结点的 <code>dist</code> 值，这将用于堆的合并操作。</li>
<li>结点的 <code>dist</code> 值等于其右子结点的 <code>dist</code> 值 + 1。</li>
</ul>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><h3 id="合并操作"><a href="#合并操作" class="headerlink" title="合并操作"></a>合并操作</h3><p>合并操作是左偏树的基础，例如合并 $A, B$ 两棵左偏树，有两种情况：</p>
<ul>
<li>一棵为空树，则直接返回另一棵树；</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!a) <span class="keyword">return</span> b;</span><br><span class="line"><span class="keyword">if</span> (!b) <span class="keyword">return</span> a;</span><br></pre></td></tr></table></figure>
<ul>
<li>若 $A,B$ 非空，且 $A$ 的键值小于 $B$ 的键值，则合并 $A$ 的右子树；</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a-&gt;c &gt; b-&gt;c) <span class="built_in">std</span>::swap (a, b);</span><br><span class="line">a-&gt;rc = Merge (a-&gt;rc, b);</span><br></pre></td></tr></table></figure>
<p>接着，为了维护左偏树的左偏性质，我们需要更新结点的 <code>dist</code> 值。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!a-&gt;lc || a-&gt;lc-&gt;dist &lt; a-&gt;rc-&gt;dist) <span class="built_in">std</span>::swap (a-&gt;lc, a-&gt;rc);</span><br><span class="line">a-&gt;dist = a-&gt;rc ? a-&gt;rc-&gt;dist + <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">a-&gt;Update ();</span><br><span class="line"><span class="keyword">return</span> a;</span><br></pre></td></tr></table></figure></p>
<h3 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h3><p>我们将需要插入的结点看作一棵只有一个结点的左偏树，直接合并即可。</p>
<h3 id="删除根结点"><a href="#删除根结点" class="headerlink" title="删除根结点"></a>删除根结点</h3><p>直接合并其左右子树即可。</p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="「APIO2012」Dispatching"><a href="#「APIO2012」Dispatching" class="headerlink" title="「APIO2012」Dispatching"></a>「APIO2012」Dispatching</h3><p>给定一棵 $n$ 个结点的有根树，每个结点有 $Ci$ 和 $Li$ ，预算为 $M$，在该树中选择一个以 $R$ 为根的子树，并在其中选择一些结点，使得这些结点的 $Ci$ 的和不超过 $M$ ，但人数尽量多。</p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>深搜至子结点，结点处建立一棵左偏树，维护最大值，将不同结点处的左偏树合并，若左偏树的值大于了 $M$ 则将堆顶元素弹出。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LeftTree</span> &#123;</span></span><br><span class="line">	LeftTree *lc, *rc;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> dist, sum, c, size;</span><br><span class="line"></span><br><span class="line">	LeftTree (<span class="keyword">long</span> <span class="keyword">long</span> c) : c (c) , lc (<span class="literal">NULL</span>), rc (<span class="literal">NULL</span>), dist (<span class="number">0</span>), sum (c), size (<span class="number">1</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">		size = (lc ? lc-&gt;size : <span class="number">0</span>) + (rc ? rc-&gt;size : <span class="number">0</span>) + <span class="number">1</span>;</span><br><span class="line">		sum = (lc ? lc-&gt;sum : <span class="number">0</span>) + (rc ? rc-&gt;sum : <span class="number">0</span>) + c;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">static</span> LeftTree *<span class="title">Merge</span> <span class="params">(LeftTree *a, LeftTree *b)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!a) <span class="keyword">return</span> b;</span><br><span class="line">		<span class="keyword">if</span> (!b) <span class="keyword">return</span> a;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (a-&gt;c &lt; b-&gt;c) <span class="built_in">std</span>::swap (a, b);</span><br><span class="line"></span><br><span class="line">		a-&gt;rc = Merge (a-&gt;rc, b);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!a-&gt;lc || a-&gt;lc-&gt;dist &lt; a-&gt;rc-&gt;dist) <span class="built_in">std</span>::swap (a-&gt;lc, a-&gt;rc);</span><br><span class="line"></span><br><span class="line">		a-&gt;dist = a-&gt;rc ? a-&gt;rc-&gt;dist + <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">		a-&gt;Update ();</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> *<span class="title">edges</span>;</span></span><br><span class="line">	<span class="keyword">int</span> c, l;</span><br><span class="line">	LeftTree *lt;</span><br><span class="line">&#125; nodes[MAXN + <span class="number">3</span>], *id[MAXN + <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	Node *from, *to;</span><br><span class="line">	Edge *next;</span><br><span class="line"></span><br><span class="line">	Edge (Node *u, Node *v) : from (u), to (v), next (from-&gt;edges) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddEdge</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> s, <span class="keyword">const</span> <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	nodes[s].edges = <span class="keyword">new</span> Edge (nodes + s, nodes + t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">BFS</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">queue</span>&lt;Node *&gt; qs;</span><br><span class="line">	qs.push (nodes + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> cnt = <span class="number">1</span>; !qs.empty (); cnt++) &#123;</span><br><span class="line">		Node *v = qs.front ();</span><br><span class="line">		qs.pop ();</span><br><span class="line">		id[cnt] = v;</span><br><span class="line">		<span class="keyword">for</span> (Edge *e = v-&gt;edges; e; e = e-&gt;next) &#123;</span><br><span class="line">			qs.push (e-&gt;to);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n, m;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, fa; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d"</span>, &amp;fa);</span><br><span class="line">		<span class="keyword">if</span> (fa) AddEdge (fa, i);</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;nodes[i].c, &amp;nodes[i].l);</span><br><span class="line">		nodes[i].lt = <span class="keyword">new</span> LeftTree (nodes[i].c);</span><br><span class="line">	&#125;</span><br><span class="line">	BFS ();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i&gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">		Node *v = id[i];</span><br><span class="line">		<span class="keyword">for</span> (Edge *e = v-&gt;edges; e; e = e-&gt;next) v-&gt;lt = LeftTree::Merge (v-&gt;lt, e-&gt;to-&gt;lt);</span><br><span class="line">		<span class="keyword">while</span> (v-&gt;lt-&gt;sum &gt; m) v-&gt;lt = LeftTree::Merge (v-&gt;lt-&gt;lc, v-&gt;lt-&gt;rc);</span><br><span class="line">		ans = <span class="built_in">std</span>::max (ans, v-&gt;lt-&gt;size * v-&gt;l);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">"%lld\n"</span>, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 二叉树 </tag>
            
            <tag> 可并堆 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[「UVa442」Matrix Chain Multiplication]]></title>
      <url>http://blog.grapedge.top/2016/11/matrix-chain-multiplication/</url>
      <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>给定 $n (1 \leq n \leq 26)$ 个矩阵以及一些矩阵链乘表达式，求每一个表达式的运算次数。</p>
<a id="more"></a>
<h2 id="解析表达式"><a href="#解析表达式" class="headerlink" title="解析表达式"></a>解析表达式</h2><p>题目中的输入是诸如 $(((((DE)F)G)H)I)$ 的表达式。</p>
<blockquote>
<p>SecondPart = Line { Line } <eof><br>Line = Expression <cr><br>Expression = Matrix | “(“ Expression Expression “)”<br>Matrix = “A” | “B” | “C” | … | “X” | “Y” | “Z”    </cr></eof></p>
</blockquote>
<p>因为输入均合法，所以我们不需要在括号匹配上深究，由输入格式知，括号内的元素恒为一对，这也就是说我们只需要一个用来存储数字的栈就可以了。当我们遇到 <code>)</code> 时，弹出两个栈顶元素并进行运算即可。</p>
<h3 id="简单的括号匹配"><a href="#简单的括号匹配" class="headerlink" title="简单的括号匹配"></a>简单的括号匹配</h3><p>输入一个字符串，这个字符串由 <code>(</code> 和 <code>)</code> 构成，判断括号是否能够匹配。</p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p><del>由于做这题之前做了半小时的括号匹配</del>，遇到 <code>(</code> 时将 <code>(</code> 压栈，遇到 <code>)</code> 时<strong>栈非空</strong>时出栈，判断栈内是否有剩余元素。代码略…</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 26</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> a, b;</span><br><span class="line">	Matrix (<span class="keyword">int</span> a = <span class="number">0</span>, <span class="keyword">int</span> b = <span class="number">0</span>) : a (a), b (b) &#123;&#125;</span><br><span class="line">&#125; nodes[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::ios::sync_with_stdio (<span class="literal">false</span>);</span><br><span class="line">	<span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">		<span class="keyword">char</span> ch;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; ch;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; nodes[ch - <span class="string">'A'</span>].a &gt;&gt; nodes[ch - <span class="string">'A'</span>].b;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">stack</span>&lt;Matrix&gt; stk;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">string</span> str;</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; str) &#123;</span><br><span class="line">		<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length (); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (str[i] == <span class="string">'('</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (str[i] == <span class="string">')'</span>) &#123;</span><br><span class="line">				Matrix ta = stk.top ();</span><br><span class="line">				stk.pop ();</span><br><span class="line">				Matrix tb = stk.top ();</span><br><span class="line">				stk.pop ();</span><br><span class="line">				<span class="keyword">if</span> (ta.a != tb.b) &#123;</span><br><span class="line">					flag = <span class="literal">true</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				ans += ta.b * tb.b * tb.a;</span><br><span class="line">				stk.push (Matrix (tb.a, ta.b));</span><br><span class="line">			&#125; <span class="keyword">else</span> stk.push (nodes[str[i] - <span class="string">'A'</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (!stk.empty ()) stk.pop ();</span><br><span class="line">		<span class="keyword">if</span> (flag) <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"error\n"</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> UVa </tag>
            
            <tag> 栈 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[std::bitset 笔记]]></title>
      <url>http://blog.grapedge.top/2016/11/bitset-note/</url>
      <content type="html"><![CDATA[<p>我们可以使用 <code>bitset</code> 来进行一些位运算，它使得位运算更加简单。特别是 <code>bitset</code> 可以处理超过 <code>unisigned long long</code> 的位大小的位集合。用 <code>bitset</code> 来代替 <code>bool</code> 数组将减少很大的空间。</p>
<a id="more"></a>
<h2 id="定义及初始化"><a href="#定义及初始化" class="headerlink" title="定义及初始化"></a>定义及初始化</h2><p>在头文件 <code>&lt;bitset&gt;</code> 定义<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt; <span class="built_in">std</span>::<span class="keyword">size_t</span> N &gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bitset</span>;</span></span><br></pre></td></tr></table></figure></p>
<p>当我们定义一个 <code>bitset</code> 时要说明其包含多少个二进制位<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bitset</span>&lt;8&gt; bs;</span><br></pre></td></tr></table></figure></p>
<p>这指明 <code>bs</code> 含有 <code>8</code> 个二进制位，将其输出：<code>00000000</code></p>
<table>
<thead>
<tr>
<th>初始化</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>bitset&lt;n&gt; bs;</td>
<td>声明 bs 有 $n$ 位，每一位均为 $0$ ，构造函数为 $constexpr$</td>
</tr>
<tr>
<td>bitset&lt;n&gt; bs (u);</td>
<td>$u$ 为一个 <code>unsigned long long</code> 类型，如果 $n$ 大于 <code>unsigned long long</code> 的大小，则 bs 中超出 <code>unsigned long long</code> 的部分用 $0$ 填充，构造函数为 $constexpr$</td>
</tr>
<tr>
<td>bitset&lt;n&gt; bs (s/cp, pos, m, zero, one);</td>
<td>从字符串 $s$ 或 C风格字符串 $cp$ 中拷贝 $m$ 个字符，<code>zero</code> 和 <code>one</code> 分别表示在这个字符串中的 $0$ 和 $1$ 用哪个字符表示</td>
</tr>
</tbody>
</table>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;32&gt; bs_1;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; bs_1 &lt;&lt; <span class="string">", size:"</span> &lt;&lt; <span class="keyword">sizeof</span> (bs_1) &lt;&lt; <span class="string">'\n'</span>; <span class="comment">// =&gt; size: 4</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;64&gt; bs_2;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; bs_2 &lt;&lt; <span class="string">", size:"</span> &lt;&lt; <span class="keyword">sizeof</span> (bs_2) &lt;&lt; <span class="string">'\n'</span>; <span class="comment">// =&gt; size: 8</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;3&gt; bs_3 (<span class="number">7</span>);</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; bs_3 &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// string 的下标习惯与bitset相反 </span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;32&gt; bs_4 (<span class="string">"1100"</span>);  <span class="comment">// -std=c++11</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; bs_4 &lt;&lt; <span class="string">'\n'</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>首先 <code>bitset</code> 支持位运算（<del>废话</del>），与内置用于 <code>unsigned long long</code> 含义相同。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>bs.any()</td>
<td>是否存在已置位的二进位</td>
</tr>
<tr>
<td>bs.all()</td>
<td>是否每一位均已置位</td>
</tr>
<tr>
<td>bs.none()</td>
<td>是否不存在已经置位的二进制位</td>
</tr>
<tr>
<td>bs.count()</td>
<td>bs中已置位的二进制位的位数</td>
</tr>
<tr>
<td>bs.size()</td>
<td>$constexpr$ 函数，返回bs的位数</td>
</tr>
<tr>
<td>bs.test(pos)</td>
<td>判断pos处是否已置位</td>
</tr>
<tr>
<td>bs.set(pos, v = true)</td>
<td>设置pos处的值为 <code>true</code> 或 <code>false</code></td>
</tr>
<tr>
<td>bs.reset()</td>
<td>将bs中所有位复位</td>
</tr>
<tr>
<td>bs.reset(pos)</td>
<td>将pos处复位</td>
</tr>
<tr>
<td>bs.flip()</td>
<td>改变bs中各位的状态</td>
</tr>
<tr>
<td>bs.flip(pos)</td>
<td>改变pos处状态</td>
</tr>
<tr>
<td>bs[pos]</td>
<td>访问pos处的值</td>
</tr>
<tr>
<td>bs.to_ulong()/bs.to_ullong()</td>
<td>返回一个<code>unsigned long</code> 或 <code>unsigned long long</code>类型的值，其二进制位与bs相同</td>
</tr>
<tr>
<td>bs.to_string(zero, one)</td>
<td>返回bs位模式的字符串</td>
</tr>
<tr>
<td>os &lt;&lt; bs</td>
<td>将bs打印为 <code>0</code>、<code>1</code></td>
</tr>
<tr>
<td>is &lt;&lt; bs</td>
<td>从流中读入，当超过其大小或下个字符非 <code>0</code> 或 <code>1</code> 时终止</td>
</tr>
</tbody>
</table>
<h2 id="接收邻接矩阵"><a href="#接收邻接矩阵" class="headerlink" title="接收邻接矩阵"></a>接收邻接矩阵</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 1001</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;maxn&gt; G[maxn];</span><br><span class="line">	<span class="keyword">int</span> n, m;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, u, v; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v;</span><br><span class="line">		G[u][v] = <span class="literal">true</span>;</span><br><span class="line">		G[v][u] = <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">			<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; G[i][j] &lt;&lt; <span class="string">' '</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>输入及输出</th>
</tr>
</thead>
<tbody>
<tr>
<td>5 3<br>1 2<br>2 3<br>3 5<br>0 0 0 0 0<br>0 0 1 0 0<br>0 1 0 1 0<br>0 0 1 0 0<br>0 0 0 0 0</td>
</tr>
</tbody>
</table>
]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> STL </tag>
            
            <tag> bitset </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[差分思想及应用]]></title>
      <url>http://blog.grapedge.top/2016/11/difference/</url>
      <content type="html"><![CDATA[<h2 id="一维差分"><a href="#一维差分" class="headerlink" title="一维差分"></a>一维差分</h2><p>有一个序列，$m$ 次操作，每次操作将区间 $[L,R]$ 中的数字加 $x$，输出这个序列。</p>
<h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>如果数据范围很小，可以直接进行模拟，但如果数据范围很大的话，可以考虑<code>线段树</code>。一种更简单的做法：使用<code>差分</code>的思想。在开始前，要接触<code>前缀和</code>的概念。</p>
<a id="more"></a>
<h3 id="前缀和"><a href="#前缀和" class="headerlink" title="前缀和"></a>前缀和</h3><p>设前缀和 $sum(i)$ 表示原数组从第 $1$ 个到第 $i$ 个的值得和。<br>设原数组为 $A$，也就是说：<br>$$sum(i)= \sum\limits_{k=1}^i A_k$$</p>
<table>
<thead>
<tr>
<th>类型/i</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>原数组</td>
<td>3</td>
<td>5</td>
<td>7</td>
<td>-5</td>
<td>-3</td>
<td>2</td>
<td>5</td>
<td>12</td>
<td>-16</td>
<td>13</td>
</tr>
<tr>
<td>前缀和</td>
<td>3</td>
<td>8</td>
<td>15</td>
<td>10</td>
<td>7</td>
<td>9</td>
<td>14</td>
<td>26</td>
<td>10</td>
<td>23</td>
</tr>
</tbody>
</table>
<p>前缀和可以用来快速求和，这也是使用差分思想的工具。</p>
<h3 id="差分"><a href="#差分" class="headerlink" title="差分"></a>差分</h3><p>我们要用到一个新的数组（当然你也可以直接修改原数组），我们把这个数组叫做<code>差分数组</code>，这个数组表示在某个区间内进行修改的值。例如我们要对 $[3,5]$ 这个区间中的每个元素增加 $1$，我们可以用差分数组（设为 $C$ ）这样表示： $C_3 + 1, C_6 - 1$，这样我们对差分数组做前缀和，就可以得到其原数组每个元素最后增加的值。</p>
<table>
<thead>
<tr>
<th>类型/i</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody>
<tr>
<td>原数组</td>
<td>3</td>
<td>5</td>
<td>7</td>
<td>-5</td>
<td>-3</td>
<td>2</td>
<td>5</td>
<td>12</td>
<td>-16</td>
<td>13</td>
<td></td>
</tr>
<tr>
<td>前缀和</td>
<td>3</td>
<td>8</td>
<td>15</td>
<td>10</td>
<td>7</td>
<td>9</td>
<td>14</td>
<td>26</td>
<td>10</td>
<td>23</td>
<td></td>
</tr>
<tr>
<td>差分数组</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>+1</td>
<td>0</td>
<td>0</td>
<td>-1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>差分前缀和</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>同理，我们如果要进行多次操作，只要修改差分数组即可，修改是 $\Theta (1)$ 的，而做前缀和是 $\Theta (n)$ 的。</p>
<blockquote>
<p>差分数组比普通数组多了一个元素，考虑 $R$ 为原数组最后一个元素时， 那么我们在差分数组中需要在 $R-1$ 位置恢复我们的修改，多一个元素其实是为了防止数组越界。当然，你可以进行特判来避免数组越界</p>
</blockquote>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 10001</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> C[maxn + <span class="number">1</span>] = &#123;<span class="number">0</span>&#125;, A[maxn];</span><br><span class="line">	<span class="keyword">int</span> n, m, L, R, x;    <span class="comment">// 序列大小，询问次数，左右区间，增量</span></span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span> (<span class="string">"%d"</span>, A + i);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) <span class="built_in">scanf</span> (<span class="string">"%d%d%d"</span>, &amp;L, &amp;R, &amp;x), C[L] += x, C[R + <span class="number">1</span>] -= x;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) C[i] += C[i - <span class="number">1</span>], A[i] = A[i] + C[i], <span class="built_in">printf</span> (<span class="string">"%d "</span>, A[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二维差分"><a href="#二维差分" class="headerlink" title="二维差分"></a>二维差分</h2><p>有 $n\times m$ 的矩阵，每次修改其中一个子矩阵，输出最后的矩阵。</p>
<h3 id="引入-1"><a href="#引入-1" class="headerlink" title="引入"></a>引入</h3><p>有了一维差分的思想，很容易想到这或许也可以进行差分。很容易想到，把这个矩阵分成 $n$ 行，每一行都是一个序列，这样就可以当做一维差分来做。但这样做可能会超时，所以我们需要换一种思路进行二维差分。</p>
<h3 id="二维前缀和"><a href="#二维前缀和" class="headerlink" title="二维前缀和"></a>二维前缀和</h3><p>设 $sum(i,j)$ 表示从 $(0,0)$ 到 $(i,j)$ 所包含的矩形区域的和。 </p>
<p><img src="http://oed2kdm1n.bkt.clouddn.com/public/16-11-10/66594491.jpg" alt="pic"></p>
<p>例如，求图中红色格子所代表的前缀和的值，设为 $sum(i,j)$ ，则<br>$sum(i-1,j)$ 为<code>橙色</code>部分加<code>紫色</code>部分），<br>$sum(i, j-1)$ 为<code>绿色</code>部分加<code>紫色</code>部分，<br>$sum(i-1,j-1)$为<code>紫色</code>部分，</p>
<p>显然，$sum(i,j)$ 为图中绿色部分加紫色部分加橙色部分加上这个格子本身的值。</p>
<p>$sum(i,j) = sum(i-1, j) + sum(i, j-1) - sum(i-1,j-1)$</p>
<h3 id="差分-1"><a href="#差分-1" class="headerlink" title="差分"></a>差分</h3><p>假如我们要对图中<code>绿色</code>区域进行 <code>+1s</code> 的操作，只需要对差分数组按照<strong>如图位置</strong>进行修改即可。</p>
<p><img src="http://oed2kdm1n.bkt.clouddn.com/public/16-11-10/70471048.jpg" alt="area"></p>
<p>然后我们对差分数组求前缀和即可得到原矩阵被修改后的样子。</p>
<p>为什么要这么差分？<br>考虑图中<code>红色</code>部分 <code>+1s</code> 后再求前缀和将影响哪些区域。<br><img src="http://oed2kdm1n.bkt.clouddn.com/public/16-11-10/59823082.jpg" alt="red"><br>显然，图中<code>紫色</code>方框内的元素在进行前缀和运算时会受到影响，因为他们的 $sum$ 的值包含了<code>红色</code>格子，而红色格子被 <code>+1s</code>了。<br><img src="http://oed2kdm1n.bkt.clouddn.com/public/16-11-10/28137155.jpg" alt="pr"><br>同理其他格子也是一样，可以发现像这样差分后影响的只有图中<code>绿色</code>区域。</p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p><a href="https://www.luogu.org/problem/show?pid=3397" target="_blank" rel="noopener">[地毯-洛谷3397]</a></p>
<p>在 $n\times n$ 的格子上有 $m$ 个地毯。<br>给出这些地毯的信息，问每个点被多少个地毯覆盖。</p>
<table>
<thead>
<tr>
<th>样例输入</th>
</tr>
</thead>
<tbody>
<tr>
<td>5 3</td>
</tr>
<tr>
<td>2 2 3 3 3 3 5 5 1 2 1 4</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>样例输出</th>
</tr>
</thead>
<tbody>
<tr>
<td>0 1 1 1 0</td>
</tr>
<tr>
<td>0 1 1 0 0</td>
</tr>
<tr>
<td>0 1 2 1 1</td>
</tr>
<tr>
<td>0 0 1 1 1</td>
</tr>
<tr>
<td>0 0 1 1 1</td>
</tr>
</tbody>
</table>
<p>暴力可过，差分即可.</p>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 1003</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, a[maxn][maxn], c[maxn][maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d %d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">0</span>, x1, y1, x2, y2; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d%d%d%d"</span>, &amp;x1, &amp;y1, &amp;x2, &amp;y2);</span><br><span class="line">		c[x1][y1]++, c[x1][y2 + <span class="number">1</span>]--, c[x2 + <span class="number">1</span>][y1]--, c[x2 + <span class="number">1</span>][y2 + <span class="number">1</span>]++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">			a[i][j] = c[i][j] + a[i - <span class="number">1</span>][j] + a[i][j - <span class="number">1</span>] - a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">			<span class="built_in">printf</span> (<span class="string">"%d "</span>, a[i][j]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">putchar</span> (<span class="string">'\n'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 差分 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[「UVa10820」Send a Table]]></title>
      <url>http://blog.grapedge.top/2016/11/send-a-table/</url>
      <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>已知通过 $f(x,y)$ 可以计算 $f(x \times k, y \times k), k\in N^*$ ，求最少需要多少个 $f(x,y)$ 使得任意 $x, y \in [1,n]$ 均能够被计算出来。</p>
<a id="more"></a>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>若 $x,y$ 不互质，则会有相应的 $\gcd (x, y) \not = 1$，将 $x, y$ 除以 $\gcd (x, y)$ 后 $x$ 与 $y$ 互质。因此只要求在 $n$ 以内有多少对互质的数即可。特别的，除了 $x = 1, y = 1$ 外其他的 $x,y$ 均不相等。满足 $x &lt; y$ 的 $f(n) = \varphi(2) + \varphi(3) + \dots + \varphi (n)$， 满足 $y &lt; x$ 的 $f(n) = \varphi(2) + \varphi(3) + \dots + \varphi (n)$ ， 满足 $x = y$ 的 $f(n) = 1$<br>综上，$f(n) = 2 \times (\varphi (2) + \varphi (3) + \dots + \varphi (n)) + 1$</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 50001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> phi[maxn], sum[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Phi_Table</span> <span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) <span class="keyword">if</span> (!phi[i]) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt;= n; j += i) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!phi[j]) phi[j] = j;</span><br><span class="line">			phi[j] = phi[j] / i * (i - <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	Phi_Table (maxn - <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= maxn; i++) sum[i] = phi[i] + sum[i - <span class="number">1</span>];</span><br><span class="line">	<span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span> (<span class="string">"%d"</span>, &amp;n) &amp;&amp; n) &#123;</span><br><span class="line">		<span class="built_in">printf</span> (<span class="string">"%d\n"</span>, <span class="number">2</span> * sum[n] + <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 欧拉函数 </tag>
            
            <tag> UVa </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[欧拉函数]]></title>
      <url>http://blog.grapedge.top/2016/11/euler-note/</url>
      <content type="html"><![CDATA[<h2 id="欧拉函数"><a href="#欧拉函数" class="headerlink" title="欧拉函数"></a>欧拉函数</h2><p>欧拉函数定义为<strong>小于等于n的数中与n互质的数的数目</strong>。设 $n$ 的唯一分解式：$n = p_1^{a_1}p_2^{a_2}p_3^{a_3}\dots p_k^{a_k}$。</p>
<a id="more"></a>
<p>利用容斥原理可以证明（反正我不会qwq）：<br>$$\phi (n)=n(1-\frac 1 p_1)(1-\frac 1 p_2) \dots(1-\frac 1 p_k)$$</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">euler_phi</span> <span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> m = (<span class="keyword">int</span>)<span class="built_in">sqrt</span> (n + <span class="number">0.5</span>);</span><br><span class="line">	<span class="keyword">int</span> ans = n;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= m; i++) <span class="keyword">if</span> (n % i == <span class="number">0</span>) &#123;</span><br><span class="line">		ans = ans / i * (i - <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">while</span> (n % i == <span class="number">0</span>) n /= i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (n &gt; <span class="number">1</span>) ans = ans / n * (n - <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用筛法"><a href="#使用筛法" class="headerlink" title="使用筛法"></a>使用筛法</h2><p>若只有一个询问，求欧拉函数的时间复杂度为 $\Theta(\sqrt n)$。<br>使用筛法可以使用 $\Theta(n\log\log n)$ 的玄学复杂度打出一张表。<br>对于当前的 $i$，若此时 $\varphi[i]$ 为 $0$，那么更新其倍数。</p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> phi[maxn];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">phi_table</span> <span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) phi[i] = <span class="number">0</span>;</span><br><span class="line">	phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) <span class="keyword">if</span> (!phi[i]) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = i; j &lt;= n; j += i) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!phi[j]) phi[j] = j;</span><br><span class="line">			phi[j] = phi[j] / i * (i - <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> 欧拉函数 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[「UVa10375」Choose and Divide]]></title>
      <url>http://blog.grapedge.top/2016/11/uva10375/</url>
      <content type="html"><![CDATA[<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>已知 $C(m, n) = m! \div (n! \times (m-n)!)$，求$C(p,q)\div C(r,s)$，其中 $p,q,r,s \leq 10000$</p>
<a id="more"></a>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>使用唯一分解定理，将 $C(p,q)\div C(r,s)$ 的结果分解为若干素数相乘，并存储于数组 $e$ 中。</p>
<p>考虑如何得到 $e$。就像， $2^5 * 2^6 = 2^{11}$，利用唯一分解定理将乘数分解，并把它像上面的式子一样加入数组 $e$ 。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> d = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = <span class="number">0</span>, k = n; j &lt; primes.size (); j++) &#123;</span><br><span class="line">	<span class="keyword">while</span> (k % primes[j] == <span class="number">0</span>) &#123;</span><br><span class="line">		k /= primes[j];</span><br><span class="line">		e[j] += d;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (k == <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>乘法运算</code><br>在上面的代码中 $n$ 是我们要乘进数组 $e$ 中的数，所以我们把 $n$ 分解，而 $d = 1$ 时表示乘，相应的 $d = -1$ 时表示除。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 10001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> e[maxn], p, q, r, s;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; primes;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">AddFactorial</span> <span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = <span class="number">0</span>, k = i; j &lt; primes.size (); j++) &#123;</span><br><span class="line">			<span class="keyword">while</span> (k % primes[j] == <span class="number">0</span>) &#123;</span><br><span class="line">				k /= primes[j];</span><br><span class="line">				e[j] += d;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (k == <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">bool</span> vis[maxn];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= <span class="number">10000</span>; i++) <span class="keyword">if</span> (!vis[i]) </span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = i * i; j &lt;= <span class="number">10000</span>; j += i) vis[j] = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= <span class="number">10000</span>; i++) <span class="keyword">if</span> (!vis[i]) primes.push_back (i);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span> (<span class="string">"%d%d%d%d"</span>, &amp;p, &amp;q, &amp;r, &amp;s) == <span class="number">4</span>) &#123;</span><br><span class="line">		<span class="built_in">memset</span> (e, <span class="number">0</span>, <span class="keyword">sizeof</span> (e));</span><br><span class="line">		AddFactorial (p, <span class="number">1</span>);</span><br><span class="line">		AddFactorial (q, <span class="number">-1</span>);</span><br><span class="line">		AddFactorial (p - q, <span class="number">-1</span>);</span><br><span class="line">		AddFactorial (r, <span class="number">-1</span>);</span><br><span class="line">		AddFactorial (s, <span class="number">1</span>);</span><br><span class="line">		AddFactorial (r - s, <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">double</span> ans = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; primes.size (); i++) <span class="keyword">if</span> (e[i]) &#123;</span><br><span class="line">			ans *= <span class="built_in">pow</span> (primes[i], e[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span> (<span class="string">"%.5lf\n"</span>, ans);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 数论 </tag>
            
            <tag> UVa </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[「NOIP2012」同余方程]]></title>
      <url>http://blog.grapedge.top/2016/11/noip-2012-d2t1/</url>
      <content type="html"><![CDATA[<h2 id="简序"><a href="#简序" class="headerlink" title="简序"></a>简序</h2><p>对于$a \equiv b \pmod n$，它表示 $a$ 和 $b$ 在<strong>模意义</strong>下除以 $n$ 的余数相等。模意义也就是进行取模运算，而非取余运算，如$-1  \equiv 2 \pmod 3$。</p>
<blockquote>
<p><strong>同余：</strong>如果两个整数 $a$ 和 $b$ 满足 $(a-b) $ 能够被整数 $n$ 整除，即 $(a-b)/n$ 得到一个整数，那么就称整数 $a$ 与 $b$ 对模 $n$ 同余</p>
</blockquote>
<a id="more"></a>
<p>若 $a \equiv b \pmod n $，则 $a \mod n = b \mod n$，则 $(a - b) \mod n = 0$，也就是说 $a \equiv b \pmod n$，$a-b$是 $n$ 的整数倍。</p>
<h2 id="同余方程"><a href="#同余方程" class="headerlink" title="同余方程"></a>同余方程</h2><p>求关于 $x$ 同余方程 $ax \equiv 1 \pmod b$的最小正整数解。</p>
<table>
<thead>
<tr>
<th>样例输入</th>
<th>样例输出</th>
</tr>
</thead>
<tbody>
<tr>
<td>3 10</td>
<td>7</td>
</tr>
</tbody>
</table>
<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>若 $ax \equiv 1 \pmod b$， 即 $ax - 1$ 是 $b$ 的整数倍，这样题目变成了 $ax - 1 = by$ ，也就是 $ax - by = 1$<br>使用扩欧即可求出 $ax - by = \gcd(a,b)$ 的一组解。</p>
<blockquote>
<p>若方程 $ax + by = \gcd(a,b)$ 的一组解为 $(x_0, y_0)$ ，则当 $c$ 是 $\gcd(a,b)$ 的整数倍时 $ax + by = c$ 的一组解为 $(x_0\times c \div \gcd(a, b), y_0\times c \div \gcd (a, b))$</p>
</blockquote>
<p>关于扩欧的资料可以参考：<a href="http://gavin_nicholas.coding.me/Extended-Euclidean-Algorithm/" target="_blank" rel="noopener">Gavin’s Blog</a></p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ExGCD</span> <span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> &amp;ans, <span class="keyword">int</span> &amp;x, <span class="keyword">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!b) ans = a, x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">else</span> ExGCD (b, a % b, ans, y, x), y -= x * (a / b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a, b, x, y, ans;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d %d"</span>, &amp;a, &amp;b);</span><br><span class="line">	ExGCD (a, -b, ans, x, y);</span><br><span class="line">	x = x * <span class="number">1</span> / ans;</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">"%d\n"</span>, (x % b + b) % b);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 数论 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[「Unity」纯色渲染Sprite]]></title>
      <url>http://blog.grapedge.top/2016/11/unity-color-shader/</url>
      <content type="html"><![CDATA[<h2 id="内容引入"><a href="#内容引入" class="headerlink" title="内容引入"></a>内容引入</h2><p>在三国志曹操传或其Mod有一个经典的镜头，就是角色暴击。当角色暴击时全身都会变成白色，如下图。<br><img src="http://oed2kdm1n.bkt.clouddn.com/public/16-11-8/63867260.jpg" alt="bs"><br>在Unity中实现这种效果，只需要稍微改一下官方的Shader即可。<br><a id="more"></a></p>
<h2 id="开始制作"><a href="#开始制作" class="headerlink" title="开始制作"></a>开始制作</h2><p>这是来自Unity官方的Shader，在这里完成了对Sprites的渲染。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Sprites/Default&quot;</span><br><span class="line">&#123;</span><br><span class="line">	Properties</span><br><span class="line">	&#123;</span><br><span class="line">		[PerRendererData] _MainTex (&quot;Sprite Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">		_Color (&quot;Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">		[MaterialToggle] PixelSnap (&quot;Pixel snap&quot;, Float) = 0</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	SubShader</span><br><span class="line">	&#123;</span><br><span class="line">		Tags</span><br><span class="line">		&#123; </span><br><span class="line">			&quot;Queue&quot;=&quot;Transparent&quot; </span><br><span class="line">			&quot;IgnoreProjector&quot;=&quot;True&quot; </span><br><span class="line">			&quot;RenderType&quot;=&quot;Transparent&quot; </span><br><span class="line">			&quot;PreviewType&quot;=&quot;Plane&quot;</span><br><span class="line">			&quot;CanUseSpriteAtlas&quot;=&quot;True&quot;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Cull Off</span><br><span class="line">		Lighting Off</span><br><span class="line">		ZWrite Off</span><br><span class="line">		Blend One OneMinusSrcAlpha</span><br><span class="line"></span><br><span class="line">		Pass</span><br><span class="line">		&#123;</span><br><span class="line">		CGPROGRAM</span><br><span class="line">			#pragma vertex vert</span><br><span class="line">			#pragma fragment frag</span><br><span class="line">			#pragma multi_compile _ PIXELSNAP_ON</span><br><span class="line">			#include &quot;UnityCG.cginc&quot;</span><br><span class="line">			</span><br><span class="line">			struct appdata_t</span><br><span class="line">			&#123;</span><br><span class="line">				float4 vertex   : POSITION;</span><br><span class="line">				float4 color    : COLOR;</span><br><span class="line">				float2 texcoord : TEXCOORD0;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			struct v2f</span><br><span class="line">			&#123;</span><br><span class="line">				float4 vertex   : SV_POSITION;</span><br><span class="line">				fixed4 color    : COLOR;</span><br><span class="line">				half2 texcoord  : TEXCOORD0;</span><br><span class="line">			&#125;;</span><br><span class="line">			</span><br><span class="line">			fixed4 _Color;</span><br><span class="line"></span><br><span class="line">			v2f vert(appdata_t IN)</span><br><span class="line">			&#123;</span><br><span class="line">				v2f OUT;</span><br><span class="line">				OUT.vertex = mul(UNITY_MATRIX_MVP, IN.vertex);</span><br><span class="line">				OUT.texcoord = IN.texcoord;</span><br><span class="line">				OUT.color = IN.color * _Color;</span><br><span class="line">				#ifdef PIXELSNAP_ON</span><br><span class="line">				OUT.vertex = UnityPixelSnap (OUT.vertex);</span><br><span class="line">				#endif</span><br><span class="line"></span><br><span class="line">				return OUT;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			sampler2D _MainTex;</span><br><span class="line"></span><br><span class="line">			fixed4 frag(v2f IN) : SV_Target</span><br><span class="line">			&#123;</span><br><span class="line">				fixed4 c = tex2D(_MainTex, IN.texcoord) * IN.color;</span><br><span class="line">				c.rgb *= c.a;</span><br><span class="line">				return c;</span><br><span class="line">			&#125;</span><br><span class="line">		ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>观察 <code>frag</code> ，这使用了一个名为 <code>tex2D</code> 的函数，这个函数有如下原型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">float4 tex2D(sampler2D samp, float2 s)</span><br><span class="line">float4 tex2D(sampler2D samp, float2 s, inttexelOff)</span><br><span class="line">float4 tex2D(sampler2D samp, float3 s)</span><br><span class="line">float4 tex2D(sampler2D samp, float3 s, inttexelOff)</span><br><span class="line">float4 tex2D(sampler2D samp, float2 s,float2 dx, float2 dy)</span><br><span class="line">float4 tex2D(sampler2D samp, float2 s,float2 dx, float2 dy, int texelOff)</span><br><span class="line">float4 tex2D(sampler2D samp, float3 s,float2 dx, float2 dy)</span><br><span class="line">float4 tex2D(sampler2D samp, float3 s,float2 dx, float2 dy, int texelOff)</span><br><span class="line">int4 tex2D(isampler2D samp, float2 s)</span><br><span class="line">int4 tex2D(isampler2D samp, float2 s, inttexelOff)</span><br><span class="line">int4 tex2D(isampler2D samp, float2 s,float2 dx, float2 dy)</span><br><span class="line">int4 tex2D(isampler2D samp, float2 s,float2 dx, float2 dy, int texelOff)</span><br><span class="line">unsigned int4 tex2D(usampler2D samp, float2s)</span><br><span class="line">unsigned int4 tex2D(usampler2D samp, float2s, int texelOff)</span><br><span class="line">unsigned int4 tex2D(usampler2D samp, float2s, float2 dx, float2 dy)</span><br><span class="line">unsigned int4 tex2D(usampler2D samp, float2s, float2 dx, float2 dy,int texelOff)</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>samp</td>
<td>Sampler to lookup</td>
<td>要进行采样的对象，即纹理</td>
</tr>
<tr>
<td>s</td>
<td>Coordinates to perform the lookup</td>
<td>需进行查找的纹理坐标</td>
</tr>
<tr>
<td>dx</td>
<td>Pre computed derivative along the x axis.</td>
<td>与计算沿着x轴方向的导数</td>
</tr>
<tr>
<td>dy</td>
<td>Pre computed derivative along the y axis.</td>
<td>预计算沿着y轴方向的导数</td>
</tr>
<tr>
<td>texelOff</td>
<td>Offset to be added to obtain the final texel.</td>
<td>添加给最终纹理的偏移量</td>
</tr>
</tbody>
</table>
<p>tex2D 返回的也就是我们查找到的纹理了</p>
<p>而我们让这个纹理的 <code>rgb</code> 乘以其 <code>alpha</code> 也就得到了这个纹理应该怎么在屏幕上显示。</p>
<p>考虑将 <code>rgb</code> 换成纯色，比如白色 <code>(1,1,1,1)</code>，在乘以其 <code>alpha</code> 也就可以将纹理以纯色效果显示</p>
<p>同理，其他颜色也一样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fixed4 frag(v2f IN) : SV_Target</span><br><span class="line">&#123;</span><br><span class="line">	fixed4 c = tex2D(_MainTex, IN.texcoord) * IN.color;</span><br><span class="line">	return IN.color * c.a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> Unity </category>
            
            <category> Shader </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Shader </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[「Unity」对象池的简单使用]]></title>
      <url>http://blog.grapedge.top/2016/10/sample-object-pool/</url>
      <content type="html"><![CDATA[<h2 id="简单的引例"><a href="#简单的引例" class="headerlink" title="简单的引例"></a>简单的引例</h2><p>在射击游戏中角色通常会进行子弹的发射，一种较为直观的解决方案发射子弹时对子弹预设进行实例化，但实际上这样做将会占用大量资源且速度较慢。而对于诸如子弹创建这样大量而又对速度要求高的需求，通常使用对象池<code>Object Pool</code>来完成。</p>
<a id="more"></a>
<h2 id="简单的思想"><a href="#简单的思想" class="headerlink" title="简单的思想"></a>简单的思想</h2><p>对象池听上去比较的高大上，但其思想却非常简单。有一个由你自定义大小的<del>游泳</del>池（当然里面没有水），你可以提前将游戏物体生成，并放进这个池子中，用的时候在取出来。就是这么简单的思想。</p>
<h2 id="子弹的创建"><a href="#子弹的创建" class="headerlink" title="子弹的创建"></a>子弹的创建</h2><p>就像是子弹创建一样，我们可以提前在游戏加载时创建好所需要的子弹（比如100发子弹）并放进准备好的一个对象池中，当按下开火键时将对象池中剩下的子弹随便拿出来一发，放到枪口，发射出去，当这枚子弹达到射程后，再把它放回对象池中。</p>
<h2 id="简单的实现"><a href="#简单的实现" class="headerlink" title="简单的实现"></a>简单的实现</h2><ul>
<li>在<code>Inspector</code>面板中的预设对象，比如子弹<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Transform[] bulletPoolObjects;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span>[] bulletPoolSize;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>很容易发现这是两个数组，<code>bulletPoolObjects</code>表示的是子弹预设，当然子弹可能有多种（子弹、炮弹、石头、<del>愤怒的小鸟</del>），所以他是一个数组，下面的<code>bulletPoolSize</code>表示的是这些子弹中相对应的每种子弹的对象池大小。</p>
<ul>
<li>创建对象池</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Dictionary&lt;Transform, Transform[]&gt; bulletPool;</span><br></pre></td></tr></table></figure>
<p>这是一个映射，其key为bulletPoolObjects中的一种子弹，value表示这种子弹的对象池。</p>
<ul>
<li><p>初始化对象池</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bulletPool = <span class="keyword">new</span> Dictionary&lt;Transform, Transform[]&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bulletPoolObjects.Length; i++) &#123;</span><br><span class="line">    Transform[] curItems = <span class="keyword">new</span> Transform[bulletPoolSize[i]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; bulletPoolSize[i]; j++) &#123;</span><br><span class="line">        Transform trs = (Instantiate(bulletPoolObjects[i], Vector3.zero, Quaternion.identity) <span class="keyword">as</span> GameObject).transform;</span><br><span class="line">        trs.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">        trs.parent = transform;</span><br><span class="line"></span><br><span class="line">        curItems[j] = trs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bulletPool.Add(bulletPoolObjects[i], curItems);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>从对象池中取出对象</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Transform <span class="title">Spawn</span>(<span class="params">Transform obj, Vector3 pos, Quaternion rot, Transform parent</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bulletPool[obj].Length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!bulletPool[obj][i].gameObject.activeSelf) &#123;</span><br><span class="line"></span><br><span class="line">            Transform spawnItem = bulletPool[obj][i];</span><br><span class="line"></span><br><span class="line">            spawnItem.parent = parent;</span><br><span class="line">            spawnItem.position = pos;</span><br><span class="line">            spawnItem.rotation = rot;</span><br><span class="line">                </span><br><span class="line">            spawnItem.gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line">            spawnItem.BroadcastMessage(<span class="string">"OnSpawned"</span>, SendMessageOptions.DontRequireReceiver);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> spawnItem;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>放回对象池<br>放回对象池只需要将这个物体的<code>active</code>设为<code>false</code>就可以了。</p>
</li>
</ul>
<h2 id="最后…"><a href="#最后…" class="headerlink" title="最后…"></a>最后…</h2><p>一次new一个新对象不如一次new很多个对象要快…</p>
]]></content>
      
        <categories>
            
            <category> Unity </category>
            
            <category> Misc </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Object Pool </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[「Unity」创建激光效果]]></title>
      <url>http://blog.grapedge.top/2016/10/unity-beam/</url>
      <content type="html"><![CDATA[<h2 id="简序"><a href="#简序" class="headerlink" title="简序"></a>简序</h2><p>游戏中常看到一些激光的效果，当然，这很炫。不妨在开始前先想一想如何来绘制激光，如何制作激光击中的地方的破碎效果…</p>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="Angry-Bots"><a href="#Angry-Bots" class="headerlink" title="Angry Bots"></a>Angry Bots</h3><p>在低版本Unity3D中的范例工程 <code>Angry Bots</code> 中角色的红外线效果便是使用 <code>Line Renderer</code> 制作，激光又和红外线是差不多一类的物体，很自然的可以想到使用这个组件进行绘制。</p>
<a id="more"></a>
<h3 id="Line-Renderer"><a href="#Line-Renderer" class="headerlink" title="Line Renderer"></a>Line Renderer</h3><p><code>Line Renderer</code>，也就是线渲染器，听名字就觉得它是用来绘制线的，但它绘制的不是单纯的线，你可以用它来绘制简单的直线甚至复杂的曲线。当然，<code>Line Renderer</code> 并不只是绘制一个像素的直线，它也可以绘制 <code>有宽度</code> 的线，可以理解为一个面。<br><img src="http://oed2kdm1n.bkt.clouddn.com/16-10-30/53574562.jpg" alt="Line Renderer"></p>
<h3 id="UV动画"><a href="#UV动画" class="headerlink" title="UV动画"></a>UV动画</h3><p>这是和<code>Shader</code>有关的内容(反正我不会Shader)，但对于激光来说，其主要的原理就是改变<code>Material</code>的偏移<code>Offset</code>，这样自然就模拟出了动画效果。<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m_LineRenderer.material.SetTextureOffset(<span class="string">"_MainTex"</span>, <span class="keyword">new</span> Vector2(Time.time * UVTime + initialBeamOffset, <span class="number">0</span>f));</span><br></pre></td></tr></table></figure></p>
<h3 id="射线检测"><a href="#射线检测" class="headerlink" title="射线检测"></a>射线检测</h3><p>当碰撞到物体后我们希望这个激光柱的长度为到这个物体的距离，而<code>Line Renderer</code>的<code>Position</code>是用来给这条绘制的激光设置位置的，不妨在编辑器中改变其值观察效果，这样，当碰撞到了物体，便设置从发射点到碰撞点的距离为激光的长度。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (hitInfo.transform) &#123;</span><br><span class="line">           </span><br><span class="line">    <span class="comment">// 计算激光长度</span></span><br><span class="line">    beamLength = Vector3.Distance(transform.position, hitInfo.point);</span><br><span class="line">    m_LineRenderer.SetPosition(<span class="number">1</span>, <span class="keyword">new</span> Vector3(<span class="number">0</span>f, <span class="number">0</span>f, beamLength));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 给目标点添加力的效果</span></span><br><span class="line">    ApplyForce(<span class="number">0.5</span>f);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在击中点生成粒子特效</span></span><br><span class="line">    <span class="keyword">if</span> (rayPar) &#123;</span><br><span class="line">        rayPar.position = hitInfo.point - transform.forward * <span class="number">0.36</span>f;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果没有击中物体，我们当然不是天真的绘制一条无限长的线，而是规定一个最远激光可以打到的距离，比如<code>100</code>。<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未击中物体</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    beamLength = maxBeamLength;</span><br><span class="line">    m_LineRenderer.SetPosition(<span class="number">1</span>, <span class="keyword">new</span> Vector3(<span class="number">0</span>f, <span class="number">0</span>f, beamLength));</span><br><span class="line">    <span class="keyword">if</span> (rayPar)</span><br><span class="line">        rayPar.position = transform.position + transform.forward * beamLength;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样激光效果就创建完成了，如果你绘制出来的线是一片海棠红的颜色，你需要设置一下线渲染器的材质。</p>
<p><img src="http://oed2kdm1n.bkt.clouddn.com/16-10-30/52374968.jpg" alt="Final"></p>
]]></content>
      
        <categories>
            
            <category> Unity </category>
            
            <category> Shader </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Shader </tag>
            
            <tag> Line Renderer </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[多重背包与混合背包]]></title>
      <url>http://blog.grapedge.top/2016/10/multiple-pack/</url>
      <content type="html"><![CDATA[<h2 id="多重背包"><a href="#多重背包" class="headerlink" title="多重背包"></a>多重背包</h2><h3 id="内容描述"><a href="#内容描述" class="headerlink" title="内容描述"></a>内容描述</h3><p>背包体积为 $ V $ ，有 $ M $ 种物品，每种物品，第  $ i $ 件物品的体积为 $ v_i $，价值为 $ w_i $ ，有 $ m_i $ 件可用，从中选出若干件放入背包使得背包所具有的价值最大。</p>
<a id="more"></a>
<h3 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h3><p>相对于01背包，01背包是有 $ M $ 种物品而每种只有一件，多重背包则是每种物品有若干件，如果将这若干件拆分为一件一件的，和01背包也就没有区别了。这样做的时间复杂度为 $ O(V\times\sum m_i) $</p>
<hr>
<h3 id="简单优化"><a href="#简单优化" class="headerlink" title="简单优化"></a>简单优化</h3><p>这里使用二进制拆分的思想进行优化。对于第 $ i $ 种物品，有 $ m_i $ 种可用，我们可以把 $ m_i $ 拆成二进制数： $ 1,2,4,8,\dots $，这样在做01背包时，第一次考虑放一件时的最优解，第二次考虑放两件时，在放这两件时可能是单纯的只放这两件，也可能是原来已经放了一件（第一次放进去的）之后再放两件，也就是三件，这样就可以将复杂度降为 $ O(V\times\sum\log_2^{m_i}) $ </p>
<blockquote>
<p>使用二进制可以表示出任何数，比如数字在计算机中的存储</p>
</blockquote>
<hr>
<h2 id="混合背包"><a href="#混合背包" class="headerlink" title="混合背包"></a>混合背包</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>背包体积为V ,给出N个物品，每个物品占用体积为Vi,价值为Wi,每个物品要么至多取1件，要么至多取mi件（mi &gt; 1） , 要么数量无限 ， 在所装物品总体积不超过V的前提下所装物品的价值的和的最大值是多少？</p>
<h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p>先考虑01背包和完全背包，用滚动数组优化后的他们只相差一行，而在这一行中，01背包要倒着跑，因为它要保证每种物品只取一件，而完全背包是正着跑的，因为每件物品可以取无限次。这样判断一下这件物品如果是无限多的，那就正着跑完全背包，让每件物品可以取无限件。</p>
<p>而通过上面的分析多重背包可以看做01背包，所以01背包可以和多重背包一起，这样就能求出最后的结果了。</p>
<p><a href="http://codevs.cn/problem/3269/" target="_blank" rel="noopener">CodeVS混合背包</a></p>
<h4 id="很弱的Grape的代码"><a href="#很弱的Grape的代码" class="headerlink" title="很弱的Grape的代码"></a>很弱的Grape的代码</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxv 200000 + 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N, V, bag[maxv];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d %d"</span>, &amp;N, &amp;V);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>, v, w, m; i &lt;= N; i++) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d %d %d"</span>, &amp;v, &amp;w, &amp;m);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (m == <span class="number">-1</span>) </span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = v; j &lt;= V; j++) &#123;</span><br><span class="line">				bag[j] = <span class="built_in">std</span>::max (bag[j], bag[j - v] + w);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= m; m -= k, k &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">int</span> vi = v * k, wi = w * k;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = V; j &gt;= vi; j--) &#123;</span><br><span class="line">					bag[j] = <span class="built_in">std</span>::max (bag[j], bag[j - vi] + wi);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (m != <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">int</span> vi = v * m, wi = w * m;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> j = V; j &gt;= vi; j--) &#123;</span><br><span class="line">					bag[j] = <span class="built_in">std</span>::max (bag[j], bag[j - vi] + wi);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span> (<span class="string">"%d"</span>, bag[V]);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 背包问题 </tag>
            
            <tag> 动态规划 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[稀疏表]]></title>
      <url>http://blog.grapedge.top/2016/09/rmq-note/</url>
      <content type="html"><![CDATA[<p>稀疏表用于求解区间最值问题，即 <code>RMQ</code> 问题，它的空间复杂度相对于线段树以及树状数组来说要大，空间复杂度为 $\Theta (N\log_2N) $ , 也不兹磁修改操作，但其查询的时间复杂度是 $\Theta (1) $ 的。适用于：无修改且询问次数较多的 <code>RMQ</code> 问题。</p>
<!-- more
## 预处理
我们定义 $F (i, j) $ 表示区间 $[i, i + 2 ^ j] $ 的最小值，也就是从 $i$ 开始连续 $2^j$ 个数的最小值。

$$F(i,j)=
\begin{cases}
a_i& \text{j = 0}\\
\min \{F(i, j-1), F(i + 2^{j-1}, j-1) \} & \text{j > 0}
\end{cases}$$

## 询问
对于询问区间 $[x,y]$ ，我们可以首先算出来一个满足 $2^i \leq y-x+1 \leq 2^{i+1}$ 的 $i$。这样我们可以用两个长度为 $2^i$ 的区间覆盖我们进行询问的整个区间。
![此处应该有图，但这张图炸了，记得再补]()
这样，就有 
$$ ans = \min \{F(x, i), F(y-2^i+1, i)\} $$

我们不推荐使用数学库中的 $ \log $ 函数，而是直接预处理出 $n$ 以内的 $log$ 值的大小，这样查询操作的复杂度就是 $\Theta (1)$。

## 代码

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// poj3264</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">5e4</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXLOGN = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, a[MAXN], <span class="built_in">log</span>[MAXN], min[MAXN][MAXLOGN + <span class="number">3</span>], max[MAXN][MAXLOGN + <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span> (<span class="string">"%d"</span>, a + i);</span><br><span class="line">	<span class="built_in">log</span>[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) min[i][<span class="number">0</span>] = max[i][<span class="number">0</span>] = a[i], <span class="built_in">log</span>[i] = <span class="built_in">log</span>[i &gt;&gt; <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= MAXLOGN; j++) <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i + (<span class="number">1</span> &lt;&lt; j) - <span class="number">1</span> &lt;= n; i++) &#123;</span><br><span class="line">		min[i][j] = <span class="built_in">std</span>::min (min[i][j - <span class="number">1</span>], min[i + (<span class="number">1</span> &lt;&lt; j - <span class="number">1</span>)][j - <span class="number">1</span>]),</span><br><span class="line">		max[i][j] = <span class="built_in">std</span>::max (max[i][j - <span class="number">1</span>], max[i + (<span class="number">1</span> &lt;&lt; j - <span class="number">1</span>)][j - <span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">		<span class="keyword">int</span> l, r;</span><br><span class="line">		<span class="built_in">scanf</span> (<span class="string">"%d%d"</span>, &amp;l, &amp;r);</span><br><span class="line">		<span class="keyword">int</span> k = <span class="built_in">log</span>[r - l + <span class="number">1</span>];</span><br><span class="line">		<span class="built_in">printf</span> (<span class="string">"%d\n"</span>, <span class="built_in">std</span>::max (max[l][k], max[r - (<span class="number">1</span> &lt;&lt; k) + <span class="number">1</span>][k]) - <span class="built_in">std</span>::min (min[l][k], min[r - (<span class="number">1</span>&lt;&lt; k) + <span class="number">1</span>][k]));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
-->]]></content>
      
        <categories>
            
            <category> OI </category>
            
            <category> NOIP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> RMQ </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
